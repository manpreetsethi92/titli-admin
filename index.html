<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TITLI Command Center</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0f;
      color: #fff;
      min-height: 100vh;
    }
    
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
    }
    .login-box {
      background: rgba(255,255,255,0.05);
      padding: 40px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
      width: 100%;
      max-width: 360px;
    }
    .login-box h1 { font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 8px; }
    .login-box p { color: #888; font-size: 14px; text-align: center; margin-bottom: 24px; }
    .login-box input {
      width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 10px;
      color: #fff; font-size: 15px; outline: none;
    }
    .login-box button {
      width: 100%; padding: 14px; margin-top: 16px; background: #e63946;
      border: none; border-radius: 10px; color: #fff; font-size: 15px;
      font-weight: 600; cursor: pointer;
    }
    .login-box button:hover { background: #c92a36; }
    
    .dashboard { display: none; }
    .dashboard.active { display: block; }
    
    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: #0a0a0f;
      z-index: 100;
    }
    .logo { font-size: 22px; font-weight: 800; color: #e63946; }
    .logo span { color: #666; font-size: 14px; font-weight: 400; margin-left: 8px; }
    .header-actions { display: flex; gap: 12px; align-items: center; }
    .header-actions button {
      padding: 8px 16px; background: rgba(255,255,255,0.1); border: none;
      border-radius: 8px; color: #fff; cursor: pointer; font-size: 13px;
    }
    .header-actions button:hover { background: rgba(255,255,255,0.15); }
    .header-actions .logout { background: transparent; color: #888; }
    .last-updated { font-size: 11px; color: #666; }
    
    .container { max-width: 1600px; margin: 0 auto; padding: 24px; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    
    .stat-card {
      padding: 20px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
    .stat-card.blue { background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.05)); border: 1px solid rgba(59,130,246,0.3); }
    .stat-card.purple { background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.05)); border: 1px solid rgba(139,92,246,0.3); }
    .stat-card.yellow { background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.05)); border: 1px solid rgba(245,158,11,0.3); }
    .stat-card.green { background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(16,185,129,0.05)); border: 1px solid rgba(16,185,129,0.3); }
    .stat-card.red { background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.05)); border: 1px solid rgba(239,68,68,0.3); }
    .stat-card.cyan { background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(6,182,212,0.05)); border: 1px solid rgba(6,182,212,0.3); }
    .stat-card.orange { background: linear-gradient(135deg, rgba(249,115,22,0.2), rgba(249,115,22,0.05)); border: 1px solid rgba(249,115,22,0.3); }
    .stat-value { font-size: 32px; font-weight: 700; }
    .stat-label { font-size: 12px; color: #888; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-detail { font-size: 11px; color: #666; margin-top: 8px; }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
    .tab {
      padding: 10px 20px; background: rgba(255,255,255,0.05); border: none;
      border-radius: 8px; color: #888; cursor: pointer; font-size: 14px; font-weight: 500;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .tab.active { background: #e63946; color: #fff; }
    .tab .badge {
      margin-left: 8px; padding: 2px 8px; background: #f59e0b;
      border-radius: 10px; font-size: 11px; color: #000;
    }
    
    .toolbar { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
    .search {
      flex: 1; min-width: 200px; padding: 12px 16px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; color: #fff; font-size: 14px; outline: none;
    }
    .filter-btn, .toolbar select {
      padding: 12px 16px; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
      color: #888; cursor: pointer; font-size: 13px;
    }
    .filter-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .filter-btn.active { background: rgba(230,57,70,0.2); border-color: #e63946; color: #e63946; }
    
    .card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    .card.highlight { border-color: rgba(245,158,11,0.3); }
    .card.success { border-color: rgba(16,185,129,0.3); }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      font-weight: 600;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }
    .card.highlight .card-header { color: #f59e0b; }
    .card-header .count { font-size: 12px; color: #666; font-weight: 400; }
    .card-header .actions { display: flex; gap: 8px; flex-wrap: wrap; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; }
    @media (max-width: 1024px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
    
    .item-card {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.2s;
    }
    .item-card:hover { background: rgba(255,255,255,0.03); }
    .item-card:last-child { border-bottom: none; }
    .item-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg, #e63946, #f97316);
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; font-size: 16px; flex-shrink: 0;
    }
    .item-info { flex: 1; min-width: 0; }
    .item-name { font-weight: 600; font-size: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .item-sub { font-size: 12px; color: #666; }
    .item-meta { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .skill-tag {
      padding: 4px 10px; background: rgba(139,92,246,0.15);
      color: #a78bfa; border-radius: 20px; font-size: 11px;
    }
    .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; }
    .badge.green { background: rgba(16,185,129,0.15); color: #10b981; }
    .badge.yellow { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .badge.purple { background: rgba(139,92,246,0.15); color: #8b5cf6; }
    .badge.red { background: rgba(239,68,68,0.15); color: #ef4444; }
    .badge.blue { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .badge.gray { background: rgba(128,128,128,0.15); color: #888; }
    .badge.cyan { background: rgba(6,182,212,0.15); color: #06b6d4; }
    .badge.orange { background: rgba(249,115,22,0.15); color: #f97316; }
    
    .action-btn {
      padding: 8px 14px; border-radius: 8px; font-size: 12px;
      font-weight: 500; text-decoration: none; cursor: pointer; border: none;
      transition: opacity 0.2s; display: inline-flex; align-items: center; gap: 4px;
    }
    .action-btn:hover { opacity: 0.8; }
    .action-btn.primary { background: #e63946; color: #fff; }
    .action-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }
    .action-btn.green { background: #10b981; color: #fff; }
    .action-btn.blue { background: #3b82f6; color: #fff; }
    .action-btn.orange { background: #f97316; color: #fff; }
    .action-btn.purple { background: #8b5cf6; color: #fff; }
    .action-btn.small { padding: 4px 10px; font-size: 11px; }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #1a1a2e;
      border-radius: 16px;
      width: 100%;
      max-width: 700px;
      max-height: 85vh;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: #1a1a2e;
    }
    .modal-header h2 { font-size: 18px; font-weight: 600; }
    .modal-close {
      background: none; border: none; color: #888;
      font-size: 24px; cursor: pointer; line-height: 1;
    }
    .modal-body { padding: 20px; }
    .modal-section { margin-bottom: 20px; }
    .modal-section h3 { font-size: 13px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
    .modal-section p { font-size: 14px; line-height: 1.6; }
    
    .form-row { margin-bottom: 12px; }
    .form-row label { display: block; font-size: 12px; color: #888; margin-bottom: 6px; }
    .form-row input, .form-row select, .form-row textarea {
      width: 100%; padding: 10px 14px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px; color: #fff; font-size: 14px;
    }
    .form-row textarea { min-height: 80px; resize: vertical; }
    .form-inline { display: flex; gap: 12px; }
    .form-inline .form-row { flex: 1; }
    
    .empty { padding: 40px 20px; text-align: center; color: #666; font-size: 14px; }
    .loading { text-align: center; padding: 40px; color: #888; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .source-badge {
      padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase;
    }
    .source-badge.reddit { background: #ff4500; color: #fff; }
    .source-badge.craigslist { background: #5a1a8a; color: #fff; }
    .source-badge.productionhub { background: #0066cc; color: #fff; }
    .source-badge.sharegrid { background: #00b894; color: #fff; }
    .source-badge.instagram { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); color: #fff; }
    .source-badge.linkedin { background: #0077b5; color: #fff; }
    .source-badge.manual { background: #666; color: #fff; }
    
    .category-badge {
      padding: 2px 8px; border-radius: 4px; font-size: 10px; background: rgba(139,92,246,0.2); color: #a78bfa;
    }
    
    .outreach-box {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 8px;
      padding: 12px;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      cursor: pointer;
      transition: background 0.2s;
    }
    .outreach-box:hover { background: rgba(255,255,255,0.08); }
    .outreach-box::after {
      content: 'üìã Click to copy';
      display: block;
      font-size: 10px;
      color: #666;
      margin-top: 8px;
    }
    
    .stats-mini {
      display: flex; gap: 16px; padding: 16px; flex-wrap: wrap;
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .stat-mini {
      text-align: center; padding: 8px 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
    }
    .stat-mini-value { font-size: 24px; font-weight: 700; }
    .stat-mini-label { font-size: 11px; color: #666; }

    .filters-bar {
      display: flex; gap: 12px; padding: 16px 20px;
      background: rgba(255,255,255,0.02);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      flex-wrap: wrap;
      align-items: center;
    }
    .filters-bar select {
      padding: 8px 12px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 6px;
      color: #fff;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="login-screen" id="loginScreen">
    <form class="login-box" onsubmit="handleLogin(event)">
      <h1>TITLI</h1>
      <p>Command Center v4.0</p>
      <input type="password" id="password" placeholder="Enter password" required>
      <button type="submit">Enter</button>
    </form>
  </div>
  <div class="dashboard" id="dashboard">
    <header>
      <div><span class="logo">TITLI<span>Command Center</span></span></div>
      <div class="header-actions">
        <span class="last-updated" id="lastUpdated"></span>
        <button onclick="fetchAllData()">Refresh</button>
        <button class="logout" onclick="logout()">Logout</button>
      </div>
    </header>
    
    <div class="container">
      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card blue" onclick="switchTab('users')">
          <div class="stat-value" id="statUsers">0</div>
          <div class="stat-label">Total Users</div>
          <div class="stat-detail" id="statUsersDetail">-</div>
        </div>
        <div class="stat-card green" onclick="switchTab('connections')">
          <div class="stat-value" id="statConnections">0</div>
          <div class="stat-label">Connections</div>
          <div class="stat-detail">Successful matches</div>
        </div>
        <div class="stat-card purple" onclick="switchTab('requests')">
          <div class="stat-value" id="statRequests">0</div>
          <div class="stat-label">Requests</div>
          <div class="stat-detail" id="statRequestsDetail">-</div>
        </div>
        <div class="stat-card orange" onclick="switchTab('external-jobs')">
          <div class="stat-value" id="statExternalJobs">0</div>
          <div class="stat-label">External Jobs</div>
          <div class="stat-detail" id="statExternalJobsDetail">-</div>
        </div>
        <div class="stat-card cyan" onclick="switchTab('talent-targets')">
          <div class="stat-value" id="statTalentTargets">0</div>
          <div class="stat-label">Talent Targets</div>
          <div class="stat-detail" id="statTalentDetail">-</div>
        </div>
        <div class="stat-card red" onclick="switchTab('activity')">
          <div class="stat-value" id="statActivity">0</div>
          <div class="stat-label">Actions Today</div>
          <div class="stat-detail">Taj activity</div>
        </div>
      </div>
      
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" data-tab="overview">Overview</button>
        <button class="tab" data-tab="users">Users</button>
        <button class="tab" data-tab="requests">Requests</button>
        <button class="tab" data-tab="connections">Connections</button>
        <button class="tab" data-tab="external-jobs">üîç External Jobs <span class="badge" id="jobsBadge">0</span></button>
        <button class="tab" data-tab="talent-targets">üéØ Talent Targets <span class="badge" id="talentBadge">0</span></button>
        <button class="tab" data-tab="recruitment">üìä Recruitment</button>
        <button class="tab" data-tab="skill-gaps">Skill Gaps</button>
        <button class="tab" data-tab="activity">Activity</button>
      </div>
      
      <!-- Overview Tab -->
      <div class="tab-content active" id="tab-overview">
        <div class="grid-3">
          <div class="card">
            <div class="card-header">Recent Activity</div>
            <div id="recentActivity"><div class="loading">Loading...</div></div>
          </div>
          <div class="card highlight">
            <div class="card-header">New External Jobs <span class="count" id="newJobsCount">0</span></div>
            <div id="newJobs"><div class="loading">Loading...</div></div>
          </div>
          <div class="card">
            <div class="card-header">Talent Pipeline</div>
            <div id="talentPipeline"><div class="loading">Loading...</div></div>
          </div>
        </div>
      </div>
      
      <!-- Users Tab -->
      <div class="tab-content" id="tab-users">
        <div class="card">
          <div class="card-header">All Users <span class="count" id="userCount">0</span></div>
          <div id="allUsers"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- Requests Tab -->
      <div class="tab-content" id="tab-requests">
        <div class="card">
          <div class="card-header">All Requests <span class="count" id="requestCount">0</span></div>
          <div id="allRequests"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- Connections Tab -->
      <div class="tab-content" id="tab-connections">
        <div class="card success">
          <div class="card-header">Successful Connections <span class="count" id="connectionCount">0</span></div>
          <div id="allConnections"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- External Jobs Tab (Pipeline 1) -->
      <div class="tab-content" id="tab-external-jobs">
        <div class="card">
          <div class="card-header">
            <span>External Job Opportunities</span>
            <div class="actions">
              <button class="action-btn orange small" onclick="scrapeAllJobs()">üîç Scrape All Sources</button>
              <button class="action-btn secondary small" onclick="scrapeReddit()">Reddit</button>
              <button class="action-btn secondary small" onclick="scrapeCraigslist()">Craigslist</button>
              <button class="action-btn purple small" onclick="analyzeAllJobs()">ü§ñ AI Analyze All</button>
              <button class="action-btn green small" onclick="showAddJobForm()">+ Add Manual</button>
            </div>
          </div>
          
          <div class="stats-mini" id="jobsStatsMini">
            <div class="stat-mini"><div class="stat-mini-value" id="jobsTotal">0</div><div class="stat-mini-label">Total</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="jobsAnalyzed">0</div><div class="stat-mini-label">Analyzed</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="jobsMatched">0</div><div class="stat-mini-label">With Matches</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="jobsNotified">0</div><div class="stat-mini-label">Notified</div></div>
          </div>
          
          <div class="filters-bar">
            <select id="jobSourceFilter" onchange="filterJobs()">
              <option value="">All Sources</option>
              <option value="reddit">Reddit</option>
              <option value="craigslist">Craigslist</option>
              <option value="productionhub">ProductionHub</option>
              <option value="mandy">Mandy</option>
            </select>
            <select id="jobCategoryFilter" onchange="filterJobs()">
              <option value="">All Categories</option>
              <option value="film">Film</option>
              <option value="photography">Photography</option>
              <option value="music">Music</option>
              <option value="design">Design</option>
              <option value="tech">Tech</option>
              <option value="writing">Writing</option>
              <option value="marketing">Marketing</option>
            </select>
            <select id="jobStatusFilter" onchange="filterJobs()">
              <option value="">All Status</option>
              <option value="new">New</option>
              <option value="analyzed">Analyzed</option>
              <option value="notified">Notified</option>
            </select>
          </div>
          
          <div id="jobsStatus" style="display:none;padding:12px 20px;background:rgba(59,130,246,0.1);color:#60a5fa;"></div>
          
          <div id="addJobForm" style="display:none;padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);">
            <div class="form-inline">
              <div class="form-row"><label>Source</label><input type="text" id="jobSource" placeholder="Reddit, Instagram, etc."></div>
              <div class="form-row"><label>Title</label><input type="text" id="jobTitle" placeholder="Looking for photographer..."></div>
            </div>
            <div class="form-row"><label>Description</label><textarea id="jobDescription" placeholder="Full job description..."></textarea></div>
            <div class="form-inline">
              <div class="form-row"><label>Location</label><input type="text" id="jobLocation" placeholder="City, State"></div>
              <div class="form-row"><label>Budget</label><input type="text" id="jobBudget" placeholder="$500/day"></div>
              <div class="form-row"><label>URL</label><input type="text" id="jobUrl" placeholder="https://..."></div>
            </div>
            <div class="form-inline">
              <div class="form-row"><label>Poster Username</label><input type="text" id="jobPosterUsername" placeholder="@username"></div>
              <div class="form-row"><label>Poster Profile URL</label><input type="text" id="jobPosterUrl" placeholder="https://..."></div>
            </div>
            <button class="action-btn primary" onclick="saveJob()" style="width:100%;margin-top:8px;">Save Job</button>
          </div>
          
          <div id="allExternalJobs"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- Talent Targets Tab (Pipeline 2) -->
      <div class="tab-content" id="tab-talent-targets">
        <div class="card">
          <div class="card-header">
            <span>Talent Recruitment Pipeline</span>
            <div class="actions">
              <button class="action-btn cyan small" onclick="scrapeShareGrid()">üîç Scrape ShareGrid</button>
              <button class="action-btn purple small" onclick="analyzeAllTalents()">ü§ñ AI Analyze All</button>
              <button class="action-btn green small" onclick="showAddTalentForm()">+ Add Manual</button>
            </div>
          </div>
          
          <div class="stats-mini" id="talentStatsMini">
            <div class="stat-mini"><div class="stat-mini-value" id="talentTotal">0</div><div class="stat-mini-label">Total</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="talentContacted">0</div><div class="stat-mini-label">Contacted</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="talentResponded">0</div><div class="stat-mini-label">Responded</div></div>
            <div class="stat-mini"><div class="stat-mini-value" id="talentJoined">0</div><div class="stat-mini-label">Joined</div></div>
          </div>
          
          <div class="filters-bar">
            <select id="talentSourceFilter" onchange="filterTalents()">
              <option value="">All Sources</option>
              <option value="sharegrid">ShareGrid</option>
              <option value="instagram">Instagram</option>
              <option value="linkedin">LinkedIn</option>
              <option value="reddit">Reddit (Job Posters)</option>
              <option value="manual">Manual</option>
            </select>
            <select id="talentCategoryFilter" onchange="filterTalents()">
              <option value="">All Categories</option>
              <option value="film">Film</option>
              <option value="photography">Photography</option>
              <option value="music">Music</option>
              <option value="design">Design</option>
            </select>
            <select id="talentStatusFilter" onchange="filterTalents()">
              <option value="">All Status</option>
              <option value="found">Found</option>
              <option value="contacted">Contacted</option>
              <option value="responded">Responded</option>
              <option value="joined">Joined</option>
              <option value="declined">Declined</option>
            </select>
          </div>
          
          <div id="talentStatus" style="display:none;padding:12px 20px;background:rgba(6,182,212,0.1);color:#06b6d4;"></div>
          
          <div id="addTalentForm" style="display:none;padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);">
            <div class="form-inline">
              <div class="form-row"><label>Name</label><input type="text" id="talentName" placeholder="Full name"></div>
              <div class="form-row"><label>Platform</label>
                <select id="talentPlatform">
                  <option value="instagram">Instagram</option>
                  <option value="linkedin">LinkedIn</option>
                  <option value="sharegrid">ShareGrid</option>
                  <option value="behance">Behance</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
            <div class="form-row"><label>Profile URL</label><input type="text" id="talentUrl" placeholder="https://instagram.com/..."></div>
            <div class="form-inline">
              <div class="form-row"><label>Skills (comma separated)</label><input type="text" id="talentSkills" placeholder="Cinematography, Editing"></div>
              <div class="form-row"><label>Location</label><input type="text" id="talentLocation" placeholder="Los Angeles, CA"></div>
            </div>
            <div class="form-row"><label>Notes</label><input type="text" id="talentNotes" placeholder="Where you found them, why they're good..."></div>
            <button class="action-btn primary" onclick="saveTalent()" style="width:100%;margin-top:8px;">Save Talent Target</button>
          </div>
          
          <div id="allTalentTargets"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- Recruitment Tab -->
      <div class="tab-content" id="tab-recruitment">
        <div class="grid-2">
          <div class="card highlight">
            <div class="card-header">ü§ñ AI Recruitment Suggestions</div>
            <div id="recruitmentSuggestions"><div class="loading">Loading...</div></div>
          </div>
          <div class="card">
            <div class="card-header">Outreach Templates</div>
            <div id="outreachTemplates" style="padding:16px;">
              <div style="margin-bottom:16px;">
                <h4 style="font-size:13px;color:#888;margin-bottom:8px;">For Job Posters (Recruit them as clients)</h4>
                <div class="outreach-box" onclick="copyText(this.innerText)">Hey! Saw you're looking for a {skill}. We have verified {skill}s in our network ready to work. Want me to send some your way? It's free to post on Titli ü¶ã</div>
              </div>
              <div>
                <h4 style="font-size:13px;color:#888;margin-bottom:8px;">For Talent (Recruit them as users)</h4>
                <div class="outreach-box" onclick="copyText(this.innerText)">Hey! Love your work üî• We're building Titli - a community connecting creative professionals with paid opportunities. Got people actively looking for {skill}s right now. Interested? It's free ü¶ã</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Skill Gaps Tab -->
      <div class="tab-content" id="tab-skill-gaps">
        <div class="grid-2">
          <div class="card highlight">
            <div class="card-header">Skills Gap Analysis</div>
            <div id="skillGapsAll"><div class="loading">Loading...</div></div>
          </div>
          <div class="card">
            <div class="card-header">Available Skills</div>
            <div id="availableSkills"><div class="loading">Loading...</div></div>
          </div>
        </div>
      </div>
      
      <!-- Activity Tab -->
      <div class="tab-content" id="tab-activity">
        <div class="card">
          <div class="card-header">All Activity <span class="count" id="activityCount">0</span></div>
          <div id="allActivity"><div class="loading">Loading...</div></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modals -->
  <div class="modal-overlay" id="jobModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalJobTitle">Job Details</h2>
        <button class="modal-close" onclick="closeModal('jobModal')">&times;</button>
      </div>
      <div class="modal-body" id="modalJobBody"></div>
    </div>
  </div>
  
  <div class="modal-overlay" id="talentModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTalentTitle">Talent Details</h2>
        <button class="modal-close" onclick="closeModal('talentModal')">&times;</button>
      </div>
      <div class="modal-body" id="modalTalentBody"></div>
    </div>
  </div>
  <script>
    const API = "https://titly-backend-production.up.railway.app/api";
    const PASSWORD = "titli2024";
    
    // Data stores
    let users = [], requests = [], connections = [], activity = [];
    let externalJobs = [], talentTargets = [], recruitmentSuggestions = [];
    let skillGaps = {}, externalOpsStats = {};
    
    // Init
    if (localStorage.getItem("titli_admin") === "true") { 
      showDashboard(); 
      fetchAllData(); 
      setInterval(fetchAllData, 30000);
      const hash = window.location.hash.replace('#', '');
      if (hash) switchTab(hash);
    }
    
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
        window.location.hash = tab.dataset.tab;
      });
    });
    
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      const tabEl = document.querySelector(`[data-tab="${tabId}"]`);
      if (tabEl) {
        tabEl.classList.add('active');
        document.getElementById(`tab-${tabId}`).classList.add('active');
        window.location.hash = tabId;
      }
    }
    
    function handleLogin(e) {
      e.preventDefault();
      if (document.getElementById("password").value === PASSWORD) {
        localStorage.setItem("titli_admin", "true");
        showDashboard(); 
        fetchAllData(); 
        setInterval(fetchAllData, 30000);
      } else { 
        alert("Wrong password"); 
      }
    }
    
    function logout() { localStorage.removeItem("titli_admin"); location.reload(); }
    function showDashboard() { document.getElementById("loginScreen").style.display = "none"; document.getElementById("dashboard").classList.add("active"); }
    
    // Fetch all data
    async function fetchAllData() {
      try {
        const [u, r, c, a, ej, tt, sg, eos] = await Promise.all([
          fetch(`${API}/admin/users`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/requests`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/connections`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/activity?limit=100`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/external-jobs?limit=100`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/talent-targets?limit=100`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/analytics/skill-gaps`).then(res => res.json()).catch(() => ({})),
          fetch(`${API}/admin/external-ops/stats`).then(res => res.json()).catch(() => ({}))
        ]);
        
        users = u || [];
        requests = r || [];
        connections = c || [];
        activity = a || [];
        externalJobs = ej || [];
        talentTargets = tt || [];
        skillGaps = sg || {};
        externalOpsStats = eos || {};
        
        updateStats();
        render();
        document.getElementById("lastUpdated").textContent = `Updated: ${new Date().toLocaleTimeString()}`;
      } catch (e) { 
        console.error("Fetch error:", e); 
      }
    }
    
    function updateStats() {
      const telegramUsers = users.filter(u => u.telegram_connected).length;
      const todayActivity = activity.filter(a => new Date(a.timestamp).toDateString() === new Date().toDateString()).length;
      
      document.getElementById("statUsers").textContent = users.length;
      document.getElementById("statUsersDetail").textContent = `${telegramUsers} on Telegram`;
      document.getElementById("statConnections").textContent = connections.length;
      document.getElementById("statRequests").textContent = requests.length;
      document.getElementById("statRequestsDetail").textContent = `${requests.filter(r => r.status === 'completed').length} completed`;
      document.getElementById("statExternalJobs").textContent = externalJobs.length;
      document.getElementById("statExternalJobsDetail").textContent = `${externalJobs.filter(j => j.analyzed).length} analyzed`;
      document.getElementById("statTalentTargets").textContent = talentTargets.length;
      document.getElementById("statTalentDetail").textContent = `${talentTargets.filter(t => t.status === 'joined').length} joined`;
      document.getElementById("statActivity").textContent = todayActivity;
      
      // Badges
      document.getElementById("jobsBadge").textContent = externalJobs.filter(j => j.status === 'new').length;
      document.getElementById("talentBadge").textContent = talentTargets.filter(t => t.status === 'found').length;
      
      // External Ops Stats
      if (externalOpsStats.jobs) {
        document.getElementById("jobsTotal").textContent = externalOpsStats.jobs.total || 0;
        document.getElementById("jobsAnalyzed").textContent = externalOpsStats.jobs.analyzed || 0;
        document.getElementById("jobsMatched").textContent = externalOpsStats.jobs.with_matches || 0;
        document.getElementById("jobsNotified").textContent = externalOpsStats.jobs.notified || 0;
      }
      if (externalOpsStats.talents) {
        document.getElementById("talentTotal").textContent = externalOpsStats.talents.total || 0;
        document.getElementById("talentContacted").textContent = externalOpsStats.talents.contacted || 0;
        document.getElementById("talentResponded").textContent = externalOpsStats.talents.responded || 0;
        document.getElementById("talentJoined").textContent = externalOpsStats.talents.joined || 0;
      }
    }
    
    function render() {
      // Overview - Recent Activity
      document.getElementById("recentActivity").innerHTML = activity.length === 0 
        ? '<div class="empty">No activity yet</div>' 
        : activity.slice(0, 8).map(a => activityItem(a)).join("");
      
      // Overview - New Jobs
      const newJobs = externalJobs.filter(j => j.status === 'new').slice(0, 5);
      document.getElementById("newJobsCount").textContent = newJobs.length;
      document.getElementById("newJobs").innerHTML = newJobs.length === 0
        ? '<div class="empty">No new jobs</div>'
        : newJobs.map(j => jobCardMini(j)).join("");
      
      // Overview - Talent Pipeline
      const pipeline = [
        { label: 'Found', count: talentTargets.filter(t => t.status === 'found').length, color: '#3b82f6' },
        { label: 'Contacted', count: talentTargets.filter(t => t.outreach_status === 'contacted').length, color: '#f59e0b' },
        { label: 'Responded', count: talentTargets.filter(t => t.outreach_status === 'responded').length, color: '#8b5cf6' },
        { label: 'Joined', count: talentTargets.filter(t => t.status === 'joined').length, color: '#10b981' }
      ];
      document.getElementById("talentPipeline").innerHTML = `<div style="padding:16px;">${pipeline.map(p => `
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
          <div style="width:80px;font-size:13px;color:#888;">${p.label}</div>
          <div style="flex:1;height:24px;background:rgba(255,255,255,0.05);border-radius:4px;overflow:hidden;">
            <div style="width:${Math.min(p.count * 10, 100)}%;height:100%;background:${p.color};"></div>
          </div>
          <div style="width:40px;text-align:right;font-weight:600;">${p.count}</div>
        </div>
      `).join("")}</div>`;
      
      // Users
      document.getElementById("userCount").textContent = users.length;
      document.getElementById("allUsers").innerHTML = users.length === 0 
        ? '<div class="empty">No users yet</div>' 
        : users.slice(0, 50).map(u => userCard(u)).join("");
      
      // Requests
      document.getElementById("requestCount").textContent = requests.length;
      document.getElementById("allRequests").innerHTML = requests.length === 0 
        ? '<div class="empty">No requests yet</div>' 
        : requests.map(r => requestCard(r)).join("");
      
      // Connections
      document.getElementById("connectionCount").textContent = connections.length;
      document.getElementById("allConnections").innerHTML = connections.length === 0 
        ? '<div class="empty">No connections yet</div>' 
        : connections.map(c => connectionCard(c)).join("");
      
      // External Jobs
      renderExternalJobs();
      
      // Talent Targets
      renderTalentTargets();
      
      // Recruitment Suggestions
      renderRecruitmentSuggestions();
      
      // Skill Gaps
      if (skillGaps.skill_gaps && skillGaps.skill_gaps.length > 0) {
        document.getElementById("skillGapsAll").innerHTML = skillGaps.skill_gaps.map(g => `
          <div style="display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.05);">
            <div style="width:120px;font-weight:500;">${g.skill}</div>
            <div style="flex:1;display:flex;gap:8px;">
              <div style="background:rgba(239,68,68,0.3);color:#ef4444;padding:4px 8px;border-radius:4px;font-size:11px;">${g.demand} need</div>
              <div style="background:rgba(16,185,129,0.3);color:#10b981;padding:4px 8px;border-radius:4px;font-size:11px;">${g.supply} have</div>
            </div>
            <span class="badge ${g.gap > 0 ? 'red' : 'green'}">${g.gap > 0 ? '-' : '+'}${Math.abs(g.gap)}</span>
          </div>
        `).join("");
      } else {
        document.getElementById("skillGapsAll").innerHTML = '<div class="empty">No skill gaps data</div>';
      }
      
      if (skillGaps.available_skills && Object.keys(skillGaps.available_skills).length > 0) {
        document.getElementById("availableSkills").innerHTML = `<div style="padding:16px;">
          ${Object.entries(skillGaps.available_skills).slice(0, 20).map(([skill, count]) => `
            <div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05);">
              <span>${skill}</span>
              <span class="badge purple">${count}</span>
            </div>
          `).join("")}
        </div>`;
      } else {
        document.getElementById("availableSkills").innerHTML = '<div class="empty">No skills data</div>';
      }
      
      // Activity
      document.getElementById("activityCount").textContent = activity.length;
      document.getElementById("allActivity").innerHTML = activity.length === 0 
        ? '<div class="empty">No activity yet</div>' 
        : activity.map(a => activityItem(a)).join("");
    }
    
    // ============ RENDER FUNCTIONS ============
    
    function renderExternalJobs() {
      const sourceFilter = document.getElementById("jobSourceFilter")?.value || '';
      const categoryFilter = document.getElementById("jobCategoryFilter")?.value || '';
      const statusFilter = document.getElementById("jobStatusFilter")?.value || '';
      
      let filtered = externalJobs;
      if (sourceFilter) filtered = filtered.filter(j => j.source === sourceFilter);
      if (categoryFilter) filtered = filtered.filter(j => j.category === categoryFilter);
      if (statusFilter) {
        if (statusFilter === 'analyzed') filtered = filtered.filter(j => j.analyzed);
        else filtered = filtered.filter(j => j.status === statusFilter);
      }
      
      document.getElementById("allExternalJobs").innerHTML = filtered.length === 0
        ? '<div class="empty">No jobs found</div>'
        : filtered.slice(0, 50).map(j => jobCard(j)).join("");
    }
    
    function renderTalentTargets() {
      const sourceFilter = document.getElementById("talentSourceFilter")?.value || '';
      const categoryFilter = document.getElementById("talentCategoryFilter")?.value || '';
      const statusFilter = document.getElementById("talentStatusFilter")?.value || '';
      
      let filtered = talentTargets;
      if (sourceFilter) filtered = filtered.filter(t => t.source === sourceFilter);
      if (categoryFilter) filtered = filtered.filter(t => t.category === categoryFilter);
      if (statusFilter) filtered = filtered.filter(t => t.status === statusFilter || t.outreach_status === statusFilter);
      
      document.getElementById("allTalentTargets").innerHTML = filtered.length === 0
        ? '<div class="empty">No talents found</div>'
        : filtered.slice(0, 50).map(t => talentCard(t)).join("");
    }
    
    async function renderRecruitmentSuggestions() {
      try {
        const suggestions = await fetch(`${API}/admin/recruitment/suggestions`).then(r => r.json()).catch(() => []);
        
        if (!suggestions || suggestions.length === 0) {
          document.getElementById("recruitmentSuggestions").innerHTML = '<div class="empty" style="padding:20px;">No talent gaps detected! üéâ</div>';
          return;
        }
        
        document.getElementById("recruitmentSuggestions").innerHTML = `<div style="padding:16px;">${suggestions.map(s => `
          <div style="background:rgba(139,92,246,0.1);border:1px solid rgba(139,92,246,0.2);border-radius:8px;padding:16px;margin-bottom:12px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
              <strong style="font-size:16px;">${s.skill_needed}</strong>
              <span class="badge ${s.priority === 'high' ? 'red' : 'yellow'}">${s.priority} priority</span>
            </div>
            <div style="font-size:12px;color:#888;margin-bottom:12px;">
              Demand: ${s.demand} | Supply: ${s.supply} | Gap: ${s.gap}
            </div>
            <div style="margin-bottom:12px;">
              <div style="font-size:11px;color:#888;margin-bottom:4px;">Search queries:</div>
              <div style="display:flex;flex-wrap:wrap;gap:6px;">
                ${Object.entries(s.search_queries || {}).map(([platform, query]) => `
                  <a href="${getSearchUrl(platform, query)}" target="_blank" 
                     class="badge" style="background:rgba(255,255,255,0.1);color:#fff;text-decoration:none;">
                    ${platform}
                  </a>
                `).join("")}
              </div>
            </div>
            <div class="outreach-box" onclick="copyText(this.innerText)" style="font-size:12px;">
              ${s.outreach_template || ''}
            </div>
          </div>
        `).join("")}</div>`;
      } catch (e) {
        document.getElementById("recruitmentSuggestions").innerHTML = '<div class="empty">Error loading suggestions</div>';
      }
    }
    
    function getSearchUrl(platform, query) {
      const q = encodeURIComponent(query);
      switch(platform) {
        case 'instagram': return `https://www.instagram.com/explore/tags/${query.replace(/[#\s]/g, '')}`;
        case 'linkedin': return `https://www.linkedin.com/search/results/people/?keywords=${q}`;
        case 'twitter': return `https://twitter.com/search?q=${q}`;
        case 'sharegrid': return `https://www.sharegrid.com/crew?q=${q}`;
        default: return `https://www.google.com/search?q=${q}`;
      }
    }
    
    function filterJobs() { renderExternalJobs(); }
    function filterTalents() { renderTalentTargets(); }
    // ============ CARD RENDERERS ============
    
    function userCard(u) {
      const initials = (u.name || 'U').substring(0, 2).toUpperCase();
      const skills = (u.skills || []).slice(0, 3);
      return `
        <div class="item-card">
          <div class="item-header">
            <div class="avatar">${initials}</div>
            <div class="item-info">
              <div class="item-name">${u.name || 'Unknown'}</div>
              <div class="item-sub">${u.location || 'No location'} ${u.telegram_connected ? '‚úì Telegram' : ''}</div>
            </div>
            ${u.verified ? '<span class="badge green">Verified</span>' : ''}
            ${u.profile_completed ? '<span class="badge blue">Complete</span>' : '<span class="badge gray">Incomplete</span>'}
          </div>
          <div class="item-meta">
            ${skills.map(s => `<span class="skill-tag">${s}</span>`).join("")}
            ${(u.skills || []).length > 3 ? `<span class="skill-tag">+${u.skills.length - 3}</span>` : ''}
          </div>
        </div>
      `;
    }
    
    function requestCard(r) {
      const statusColors = { pending: 'yellow', completed: 'green', cancelled: 'red', searching: 'blue' };
      return `
        <div class="item-card">
          <div class="item-header">
            <div class="item-info">
              <div class="item-name">Looking for: ${r.skill_needed || 'Unknown skill'}</div>
              <div class="item-sub">By: ${r.requester_name || 'Unknown'} ‚Ä¢ ${r.location || 'Any location'}</div>
            </div>
            <span class="badge ${statusColors[r.status] || 'gray'}">${r.status || 'unknown'}</span>
          </div>
          ${r.description ? `<p style="font-size:13px;color:#888;margin-top:8px;">${r.description.substring(0, 100)}${r.description.length > 100 ? '...' : ''}</p>` : ''}
          <div class="item-meta">
            ${r.budget ? `<span class="badge purple">${r.budget}</span>` : ''}
            ${r.matches_found ? `<span class="badge cyan">${r.matches_found} matches</span>` : ''}
          </div>
        </div>
      `;
    }
    
    function connectionCard(c) {
      return `
        <div class="item-card">
          <div class="item-header">
            <div class="item-info">
              <div class="item-name">${c.requester_name || 'Unknown'} ‚Üî ${c.provider_name || 'Unknown'}</div>
              <div class="item-sub">${c.skill || 'Unknown skill'} ‚Ä¢ ${formatDate(c.created_at)}</div>
            </div>
            <span class="badge green">Connected</span>
          </div>
        </div>
      `;
    }
    
    function jobCard(j) {
      const statusColors = { new: 'yellow', analyzed: 'blue', matched: 'purple', notified: 'green', closed: 'gray' };
      return `
        <div class="item-card" onclick="showJobModal('${j.id}')">
          <div class="item-header">
            <div class="item-info">
              <div class="item-name">${j.title || 'Untitled Job'}</div>
              <div class="item-sub">
                <span class="source-badge ${j.source}">${j.source}</span>
                ${j.source_detail ? `<span style="color:#666;margin-left:4px;">${j.source_detail}</span>` : ''}
                ${j.location ? ` ‚Ä¢ ${j.location}` : ''}
                ${j.budget ? ` ‚Ä¢ ${j.budget}` : ''}
              </div>
            </div>
            <span class="badge ${statusColors[j.status] || 'gray'}">${j.status || 'new'}</span>
          </div>
          ${j.summary ? `<p style="font-size:13px;color:#888;margin:8px 0;">${j.summary}</p>` : ''}
          <div class="item-meta">
            ${j.category ? `<span class="category-badge">${j.category}</span>` : ''}
            ${(j.skills_needed || []).slice(0, 3).map(s => `<span class="skill-tag">${s}</span>`).join("")}
            ${j.analyzed ? '<span class="badge blue">Analyzed</span>' : ''}
            ${j.match_count ? `<span class="badge purple">${j.match_count} matches</span>` : ''}
            ${j.poster_recruited ? '<span class="badge green">Poster Recruited</span>' : ''}
          </div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;" onclick="event.stopPropagation()">
            ${!j.analyzed ? `<button class="action-btn purple small" onclick="analyzeJob('${j.id}')">ü§ñ Analyze</button>` : ''}
            ${j.analyzed && !j.match_count ? `<button class="action-btn blue small" onclick="matchJob('${j.id}')">üîç Find Matches</button>` : ''}
            ${j.match_count > 0 ? `<button class="action-btn green small" onclick="notifyMatches('${j.id}')">üì§ Notify Users</button>` : ''}
            ${j.poster_username && !j.poster_recruited ? `<button class="action-btn orange small" onclick="recruitPoster('${j.id}')">üéØ Recruit Poster</button>` : ''}
            ${j.url ? `<a href="${j.url}" target="_blank" class="action-btn secondary small">üîó View Original</a>` : ''}
          </div>
        </div>
      `;
    }
    
    function jobCardMini(j) {
      return `
        <div class="item-card" onclick="switchTab('external-jobs')">
          <div class="item-header">
            <div class="item-info">
              <div class="item-name" style="font-size:14px;">${(j.title || 'Untitled').substring(0, 50)}${(j.title || '').length > 50 ? '...' : ''}</div>
              <div class="item-sub"><span class="source-badge ${j.source}">${j.source}</span></div>
            </div>
          </div>
        </div>
      `;
    }
    
    function talentCard(t) {
      const statusColors = { found: 'blue', contacted: 'yellow', responded: 'purple', joined: 'green', declined: 'red' };
      const outreachColors = { pending: 'gray', contacted: 'yellow', responded: 'purple', converted: 'green' };
      return `
        <div class="item-card" onclick="showTalentModal('${t.id}')">
          <div class="item-header">
            <div class="avatar">${(t.name || 'T').substring(0, 2).toUpperCase()}</div>
            <div class="item-info">
              <div class="item-name">${t.name || 'Unknown'}</div>
              <div class="item-sub">
                <span class="source-badge ${t.source}">${t.source}</span>
                ${t.location ? ` ‚Ä¢ ${t.location}` : ''}
                ${t.primary_skill ? ` ‚Ä¢ ${t.primary_skill}` : ''}
              </div>
            </div>
            <span class="badge ${statusColors[t.status] || 'gray'}">${t.status || 'found'}</span>
          </div>
          <div class="item-meta">
            ${t.category ? `<span class="category-badge">${t.category}</span>` : ''}
            ${(t.skills_detected || []).slice(0, 3).map(s => `<span class="skill-tag">${s}</span>`).join("")}
            ${t.outreach_priority ? `<span class="badge ${t.outreach_priority === 'high' ? 'red' : t.outreach_priority === 'medium' ? 'yellow' : 'gray'}">${t.outreach_priority} priority</span>` : ''}
            ${t.outreach_status ? `<span class="badge ${outreachColors[t.outreach_status] || 'gray'}">Outreach: ${t.outreach_status}</span>` : ''}
          </div>
          ${t.suggested_message_angle ? `<p style="font-size:12px;color:#888;margin-top:8px;font-style:italic;">"${t.suggested_message_angle}"</p>` : ''}
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap;" onclick="event.stopPropagation()">
            ${!t.analyzed ? `<button class="action-btn purple small" onclick="analyzeTalent('${t.id}')">ü§ñ Analyze</button>` : ''}
            <button class="action-btn blue small" onclick="generateOutreach('${t.id}')">‚úâÔ∏è Generate Outreach</button>
            <button class="action-btn green small" onclick="updateTalentStatus('${t.id}', 'contacted')">‚úì Mark Contacted</button>
            ${t.profile_url ? `<a href="${t.profile_url}" target="_blank" class="action-btn secondary small">üîó View Profile</a>` : ''}
          </div>
        </div>
      `;
    }
    
    function activityItem(a) {
      const icons = {
        user_registered: 'üë§', profile_completed: '‚úÖ', request_created: 'üìù', match_found: 'üîç',
        connection_made: 'ü§ù', telegram_connected: 'üì±', job_scraped: 'üîé', job_analyzed: 'ü§ñ',
        matches_found: 'üéØ', job_notification_sent: 'üì§', poster_recruited: 'üé™', talent_added: 'üåü'
      };
      return `
        <div style="padding:12px 16px;border-bottom:1px solid rgba(255,255,255,0.05);display:flex;gap:12px;align-items:center;">
          <span style="font-size:18px;">${icons[a.action] || 'üìå'}</span>
          <div style="flex:1;">
            <div style="font-size:13px;">${a.description || a.action}</div>
            <div style="font-size:11px;color:#666;">${formatDate(a.timestamp)}</div>
          </div>
        </div>
      `;
    }
    
    // ============ MODAL FUNCTIONS ============
    
    function showJobModal(jobId) {
      const job = externalJobs.find(j => j.id === jobId);
      if (!job) return;
      
      document.getElementById("modalJobTitle").textContent = job.title || 'Job Details';
      document.getElementById("modalJobBody").innerHTML = `
        <div class="modal-section">
          <h3>Source</h3>
          <p><span class="source-badge ${job.source}">${job.source}</span> ${job.source_detail || ''}</p>
        </div>
        ${job.description ? `<div class="modal-section"><h3>Description</h3><p>${job.description}</p></div>` : ''}
        ${job.summary ? `<div class="modal-section"><h3>AI Summary</h3><p>${job.summary}</p></div>` : ''}
        <div class="modal-section">
          <h3>Details</h3>
          <p>
            <strong>Location:</strong> ${job.location || 'Not specified'}<br>
            <strong>Budget:</strong> ${job.budget || 'Not specified'}<br>
            <strong>Category:</strong> ${job.category || 'Unknown'}<br>
            <strong>Urgency:</strong> ${job.urgency || 'Unknown'}<br>
            <strong>Job Type:</strong> ${job.job_type || 'Unknown'}
          </p>
        </div>
        ${job.skills_needed?.length ? `<div class="modal-section"><h3>Skills Needed</h3><div class="item-meta">${job.skills_needed.map(s => `<span class="skill-tag">${s}</span>`).join("")}</div></div>` : ''}
        ${job.poster_username ? `<div class="modal-section"><h3>Poster</h3><p>@${job.poster_username} ${job.poster_profile_url ? `<a href="${job.poster_profile_url}" target="_blank">[Profile]</a>` : ''}</p></div>` : ''}
        ${job.matched_users?.length ? `<div class="modal-section"><h3>Matched Users (${job.matched_users.length})</h3>${job.matched_users.map(m => `<div style="padding:8px;background:rgba(255,255,255,0.05);border-radius:4px;margin-bottom:4px;">${m.user_name || m.user_id} - Score: ${m.score}</div>`).join("")}</div>` : ''}
        <div class="modal-section">
          <h3>Actions</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            ${!job.analyzed ? `<button class="action-btn purple" onclick="analyzeJob('${job.id}');closeModal('jobModal');">ü§ñ Analyze</button>` : ''}
            ${job.analyzed ? `<button class="action-btn blue" onclick="matchJob('${job.id}');closeModal('jobModal');">üîç Find Matches</button>` : ''}
            ${job.match_count > 0 ? `<button class="action-btn green" onclick="notifyMatches('${job.id}');closeModal('jobModal');">üì§ Notify Users</button>` : ''}
            ${job.poster_username && !job.poster_recruited ? `<button class="action-btn orange" onclick="recruitPoster('${job.id}');closeModal('jobModal');">üéØ Recruit Poster</button>` : ''}
            ${job.url ? `<a href="${job.url}" target="_blank" class="action-btn secondary">üîó View Original</a>` : ''}
          </div>
        </div>
      `;
      document.getElementById("jobModal").classList.add("active");
    }
    
    function showTalentModal(talentId) {
      const talent = talentTargets.find(t => t.id === talentId);
      if (!talent) return;
      
      document.getElementById("modalTalentTitle").textContent = talent.name || 'Talent Details';
      document.getElementById("modalTalentBody").innerHTML = `
        <div class="modal-section">
          <h3>Source</h3>
          <p><span class="source-badge ${talent.source}">${talent.source}</span> ${talent.source_type || ''}</p>
        </div>
        <div class="modal-section">
          <h3>Details</h3>
          <p>
            <strong>Location:</strong> ${talent.location || 'Not specified'}<br>
            <strong>Category:</strong> ${talent.category || 'Unknown'}<br>
            <strong>Primary Skill:</strong> ${talent.primary_skill || 'Unknown'}<br>
            <strong>Skill Level:</strong> ${talent.skill_level || 'Unknown'}<br>
            <strong>Outreach Priority:</strong> ${talent.outreach_priority || 'Unknown'}
          </p>
        </div>
        ${talent.skills_detected?.length ? `<div class="modal-section"><h3>Skills Detected</h3><div class="item-meta">${talent.skills_detected.map(s => `<span class="skill-tag">${s}</span>`).join("")}</div></div>` : ''}
        ${talent.suggested_message_angle ? `<div class="modal-section"><h3>Suggested Outreach Angle</h3><p style="font-style:italic;">"${talent.suggested_message_angle}"</p></div>` : ''}
        ${talent.notes ? `<div class="modal-section"><h3>Notes</h3><p>${talent.notes}</p></div>` : ''}
        <div class="modal-section">
          <h3>Outreach Message</h3>
          <div class="outreach-box" onclick="copyText(this.innerText)" id="talentOutreachBox">
Hey! Love your work üî•

We're building Titli - a community connecting creative professionals with paid opportunities.

Got people actively looking for ${talent.primary_skill || talent.skills_detected?.[0] || 'creatives'}s right now. Interested in joining? It's free and we handle all the matchmaking ü¶ã

titli.work
          </div>
        </div>
        <div class="modal-section">
          <h3>Update Status</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            <button class="action-btn secondary" onclick="updateTalentStatus('${talent.id}', 'found')">Found</button>
            <button class="action-btn yellow" onclick="updateTalentStatus('${talent.id}', 'contacted')">Contacted</button>
            <button class="action-btn purple" onclick="updateTalentStatus('${talent.id}', 'responded')">Responded</button>
            <button class="action-btn green" onclick="updateTalentStatus('${talent.id}', 'joined')">Joined!</button>
            <button class="action-btn red" onclick="updateTalentStatus('${talent.id}', 'declined')">Declined</button>
          </div>
        </div>
        <div class="modal-section">
          <h3>Actions</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;">
            ${!talent.analyzed ? `<button class="action-btn purple" onclick="analyzeTalent('${talent.id}')">ü§ñ Analyze</button>` : ''}
            ${talent.profile_url ? `<a href="${talent.profile_url}" target="_blank" class="action-btn secondary">üîó View Profile</a>` : ''}
          </div>
        </div>
      `;
      document.getElementById("talentModal").classList.add("active");
    }
    
    function closeModal(modalId) {
      document.getElementById(modalId).classList.remove("active");
    }
    
    // Close modal on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) overlay.classList.remove('active');
      });
    });
    
    // ============ SCRAPING ACTIONS ============
    
    async function scrapeAllJobs() {
      showStatus('jobsStatus', 'Scraping all sources... This may take a minute.');
      try {
        const res = await fetch(`${API}/admin/scrape/all-jobs`, { method: 'POST' });
        const data = await res.json();
        showStatus('jobsStatus', `‚úÖ Scraped ${data.total_scraped || 0} jobs, saved ${data.total_saved || 0} new`);
        fetchAllData();
      } catch (e) {
        showStatus('jobsStatus', '‚ùå Error scraping jobs');
      }
    }
    
    async function scrapeReddit() {
      showStatus('jobsStatus', 'Scraping Reddit...');
      try {
        const res = await fetch(`${API}/admin/scrape/reddit`, { method: 'POST' });
        const data = await res.json();
        showStatus('jobsStatus', `‚úÖ Reddit: ${data.scraped || 0} found, ${data.saved || 0} new`);
        fetchAllData();
      } catch (e) {
        showStatus('jobsStatus', '‚ùå Error scraping Reddit');
      }
    }
    
    async function scrapeCraigslist() {
      showStatus('jobsStatus', 'Scraping Craigslist...');
      try {
        const res = await fetch(`${API}/admin/scrape/craigslist`, { method: 'POST' });
        const data = await res.json();
        showStatus('jobsStatus', `‚úÖ Craigslist: ${data.scraped || 0} found, ${data.saved || 0} new`);
        fetchAllData();
      } catch (e) {
        showStatus('jobsStatus', '‚ùå Error scraping Craigslist');
      }
    }
    
    async function scrapeShareGrid() {
      showStatus('talentStatus', 'Scraping ShareGrid...');
      try {
        const res = await fetch(`${API}/admin/scrape/sharegrid`, { method: 'POST' });
        const data = await res.json();
        showStatus('talentStatus', `‚úÖ ShareGrid: ${data.scraped || 0} found, ${data.saved || 0} new`);
        fetchAllData();
      } catch (e) {
        showStatus('talentStatus', '‚ùå Error scraping ShareGrid');
      }
    }
    
    async function analyzeAllJobs() {
      showStatus('jobsStatus', 'ü§ñ Analyzing jobs with AI...');
      try {
        const res = await fetch(`${API}/admin/scrape/analyze-jobs`, { method: 'POST' });
        const data = await res.json();
        showStatus('jobsStatus', `‚úÖ Analyzed ${data.analyzed || 0} jobs, ${data.spam_detected || 0} spam detected`);
        fetchAllData();
      } catch (e) {
        showStatus('jobsStatus', '‚ùå Error analyzing jobs');
      }
    }
    
    async function analyzeAllTalents() {
      showStatus('talentStatus', 'ü§ñ Analyzing talents with AI...');
      try {
        const res = await fetch(`${API}/admin/scrape/analyze-talents`, { method: 'POST' });
        const data = await res.json();
        showStatus('talentStatus', `‚úÖ Analyzed ${data.analyzed || 0} talents`);
        fetchAllData();
      } catch (e) {
        showStatus('talentStatus', '‚ùå Error analyzing talents');
      }
    }
    
    async function analyzeJob(jobId) {
      try {
        await fetch(`${API}/admin/external-jobs/${jobId}/analyze`, { method: 'POST' });
        fetchAllData();
      } catch (e) {
        alert('Error analyzing job');
      }
    }
    
    async function matchJob(jobId) {
      try {
        const res = await fetch(`${API}/admin/external-jobs/${jobId}/match`, { method: 'POST' });
        const data = await res.json();
        alert(`Found ${data.matches_count || 0} matches!`);
        fetchAllData();
      } catch (e) {
        alert('Error finding matches');
      }
    }
    
    async function notifyMatches(jobId) {
      if (!confirm('Send notifications to all matched users?')) return;
      try {
        const res = await fetch(`${API}/admin/external-jobs/${jobId}/notify`, { method: 'POST' });
        const data = await res.json();
        alert(`Notified ${data.notified || 0} users!`);
        fetchAllData();
      } catch (e) {
        alert('Error sending notifications');
      }
    }
    
    async function recruitPoster(jobId) {
      try {
        await fetch(`${API}/admin/external-jobs/${jobId}/recruit-poster`, { method: 'POST' });
        alert('Poster added to recruitment pipeline!');
        fetchAllData();
      } catch (e) {
        alert('Error recruiting poster');
      }
    }
    
    async function analyzeTalent(talentId) {
      try {
        await fetch(`${API}/admin/talent-targets/${talentId}/analyze`, { method: 'POST' });
        fetchAllData();
        closeModal('talentModal');
      } catch (e) {
        alert('Error analyzing talent');
      }
    }
    
    async function generateOutreach(talentId) {
      try {
        const res = await fetch(`${API}/admin/talent-targets/${talentId}/generate-outreach`, { method: 'POST' });
        const data = await res.json();
        if (data.message) {
          copyText(data.message);
          alert('Outreach message copied to clipboard!');
        }
      } catch (e) {
        alert('Error generating outreach');
      }
    }
    
    async function updateTalentStatus(talentId, status) {
      try {
        await fetch(`${API}/admin/talent-targets/${talentId}`, {
          method: 'PATCH',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ status: status, outreach_status: status === 'contacted' || status === 'responded' ? status : undefined })
        });
        fetchAllData();
        closeModal('talentModal');
      } catch (e) {
        alert('Error updating status');
      }
    }
    
    // ============ FORM HANDLING ============
    
    function showAddJobForm() {
      const form = document.getElementById("addJobForm");
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }
    
    function showAddTalentForm() {
      const form = document.getElementById("addTalentForm");
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }
    
    async function saveJob() {
      const job = {
        source: document.getElementById("jobSource").value || 'manual',
        title: document.getElementById("jobTitle").value,
        description: document.getElementById("jobDescription").value,
        location: document.getElementById("jobLocation").value,
        budget: document.getElementById("jobBudget").value,
        url: document.getElementById("jobUrl").value,
        poster_username: document.getElementById("jobPosterUsername").value,
        poster_profile_url: document.getElementById("jobPosterUrl").value
      };
      
      if (!job.title) {
        alert('Title is required');
        return;
      }
      
      try {
        await fetch(`${API}/admin/import/jobs`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ jobs: [job] })
        });
        alert('Job saved!');
        document.getElementById("addJobForm").style.display = 'none';
        // Clear form
        ['jobSource', 'jobTitle', 'jobDescription', 'jobLocation', 'jobBudget', 'jobUrl', 'jobPosterUsername', 'jobPosterUrl'].forEach(id => {
          document.getElementById(id).value = '';
        });
        fetchAllData();
      } catch (e) {
        alert('Error saving job');
      }
    }
    
    async function saveTalent() {
      const talent = {
        name: document.getElementById("talentName").value,
        source: document.getElementById("talentPlatform").value,
        profile_url: document.getElementById("talentUrl").value,
        skills_detected: document.getElementById("talentSkills").value.split(',').map(s => s.trim()).filter(s => s),
        location: document.getElementById("talentLocation").value,
        notes: document.getElementById("talentNotes").value
      };
      
      if (!talent.name) {
        alert('Name is required');
        return;
      }
      
      try {
        await fetch(`${API}/admin/talent-targets`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(talent)
        });
        alert('Talent saved!');
        document.getElementById("addTalentForm").style.display = 'none';
        // Clear form
        ['talentName', 'talentUrl', 'talentSkills', 'talentLocation', 'talentNotes'].forEach(id => {
          document.getElementById(id).value = '';
        });
        fetchAllData();
      } catch (e) {
        alert('Error saving talent');
      }
    }
    
    // ============ UTILITIES ============
    
    function showStatus(elementId, message) {
      const el = document.getElementById(elementId);
      el.textContent = message;
      el.style.display = 'block';
      setTimeout(() => { el.style.display = 'none'; }, 5000);
    }
    
    function copyText(text) {
      navigator.clipboard.writeText(text).then(() => {
        // Brief visual feedback could be added here
      }).catch(() => {
        // Fallback
        const ta = document.createElement('textarea');
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand('copy');
        document.body.removeChild(ta);
      });
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);
      
      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return `${diffMins}m ago`;
      if (diffHours < 24) return `${diffHours}h ago`;
      if (diffDays < 7) return `${diffDays}d ago`;
      return date.toLocaleDateString();
    }
  </script>
</body>
</html>