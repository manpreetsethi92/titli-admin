<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TITLI Command Center</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0f;
      color: #fff;
      min-height: 100vh;
    }
    
    .login-screen {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
    }
    .login-box {
      background: rgba(255,255,255,0.05);
      padding: 40px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.1);
      width: 100%;
      max-width: 360px;
    }
    .login-box h1 { font-size: 28px; font-weight: 800; text-align: center; margin-bottom: 8px; }
    .login-box p { color: #888; font-size: 14px; text-align: center; margin-bottom: 24px; }
    .login-box input {
      width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.08);
      border: 1px solid rgba(255,255,255,0.15); border-radius: 10px;
      color: #fff; font-size: 15px; outline: none;
    }
    .login-box button {
      width: 100%; padding: 14px; margin-top: 16px; background: #e63946;
      border: none; border-radius: 10px; color: #fff; font-size: 15px;
      font-weight: 600; cursor: pointer;
    }
    .login-box button:hover { background: #c92a36; }
    
    .dashboard { display: none; }
    .dashboard.active { display: block; }
    
    header {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: #0a0a0f;
      z-index: 100;
    }
    .logo { font-size: 22px; font-weight: 800; color: #e63946; }
    .logo span { color: #666; font-size: 14px; font-weight: 400; margin-left: 8px; }
    .header-actions { display: flex; gap: 12px; align-items: center; }
    .header-actions button {
      padding: 8px 16px; background: rgba(255,255,255,0.1); border: none;
      border-radius: 8px; color: #fff; cursor: pointer; font-size: 13px;
    }
    .header-actions button:hover { background: rgba(255,255,255,0.15); }
    .header-actions .logout { background: transparent; color: #888; }
    .last-updated { font-size: 11px; color: #666; }
    
    .container { max-width: 1600px; margin: 0 auto; padding: 24px; }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 16px;
      margin-bottom: 32px;
    }
    @media (max-width: 1200px) { .stats-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 768px) { .stats-grid { grid-template-columns: repeat(2, 1fr); } }
    
    .stat-card {
      padding: 20px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .stat-card:hover { transform: translateY(-2px); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
    .stat-card.blue { background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(59,130,246,0.05)); border: 1px solid rgba(59,130,246,0.3); }
    .stat-card.purple { background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(139,92,246,0.05)); border: 1px solid rgba(139,92,246,0.3); }
    .stat-card.yellow { background: linear-gradient(135deg, rgba(245,158,11,0.2), rgba(245,158,11,0.05)); border: 1px solid rgba(245,158,11,0.3); }
    .stat-card.green { background: linear-gradient(135deg, rgba(16,185,129,0.2), rgba(16,185,129,0.05)); border: 1px solid rgba(16,185,129,0.3); }
    .stat-card.red { background: linear-gradient(135deg, rgba(239,68,68,0.2), rgba(239,68,68,0.05)); border: 1px solid rgba(239,68,68,0.3); }
    .stat-card.cyan { background: linear-gradient(135deg, rgba(6,182,212,0.2), rgba(6,182,212,0.05)); border: 1px solid rgba(6,182,212,0.3); }
    .stat-card.orange { background: linear-gradient(135deg, rgba(249,115,22,0.2), rgba(249,115,22,0.05)); border: 1px solid rgba(249,115,22,0.3); }
    .stat-value { font-size: 32px; font-weight: 700; }
    .stat-label { font-size: 12px; color: #888; margin-top: 4px; text-transform: uppercase; letter-spacing: 0.5px; }
    .stat-detail { font-size: 11px; color: #666; margin-top: 8px; }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 24px; flex-wrap: wrap; }
    .tab {
      padding: 10px 20px; background: rgba(255,255,255,0.05); border: none;
      border-radius: 8px; color: #888; cursor: pointer; font-size: 14px; font-weight: 500;
      transition: all 0.2s;
    }
    .tab:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .tab.active { background: #e63946; color: #fff; }
    .tab .badge {
      margin-left: 8px; padding: 2px 8px; background: #f59e0b;
      border-radius: 10px; font-size: 11px; color: #000;
    }
    
    .toolbar { display: flex; gap: 12px; margin-bottom: 24px; flex-wrap: wrap; }
    .search {
      flex: 1; min-width: 200px; padding: 12px 16px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; color: #fff; font-size: 14px; outline: none;
    }
    .filter-btn {
      padding: 12px 20px; background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
      color: #888; cursor: pointer; font-size: 13px;
    }
    .filter-btn:hover { background: rgba(255,255,255,0.1); color: #fff; }
    .filter-btn.active { background: rgba(230,57,70,0.2); border-color: #e63946; color: #e63946; }
    
    .card {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 24px;
    }
    .card.highlight { border-color: rgba(245,158,11,0.3); }
    .card.success { border-color: rgba(16,185,129,0.3); }
    .card-header {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      font-weight: 600;
      font-size: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .card.highlight .card-header { color: #f59e0b; }
    .card-header .count { font-size: 12px; color: #666; font-weight: 400; }
    
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px; }
    @media (max-width: 1024px) { .grid-2, .grid-3 { grid-template-columns: 1fr; } }
    
    .item-card {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      cursor: pointer;
      transition: background 0.2s;
    }
    .item-card:hover { background: rgba(255,255,255,0.03); }
    .item-card:last-child { border-bottom: none; }
    .item-header { display: flex; align-items: center; gap: 12px; margin-bottom: 10px; }
    .avatar {
      width: 40px; height: 40px; border-radius: 50%;
      background: linear-gradient(135deg, #e63946, #f97316);
      display: flex; align-items: center; justify-content: center;
      font-weight: 600; font-size: 16px; flex-shrink: 0;
    }
    .item-info { flex: 1; }
    .item-name { font-weight: 600; font-size: 15px; }
    .item-sub { font-size: 12px; color: #666; }
    .item-meta { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 8px; }
    .skill-tag {
      padding: 4px 10px; background: rgba(139,92,246,0.15);
      color: #a78bfa; border-radius: 20px; font-size: 11px;
    }
    .badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; }
    .badge.green { background: rgba(16,185,129,0.15); color: #10b981; }
    .badge.yellow { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .badge.purple { background: rgba(139,92,246,0.15); color: #8b5cf6; }
    .badge.red { background: rgba(239,68,68,0.15); color: #ef4444; }
    .badge.blue { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .badge.gray { background: rgba(128,128,128,0.15); color: #888; }
    .badge.cyan { background: rgba(6,182,212,0.15); color: #06b6d4; }
    .badge.orange { background: rgba(249,115,22,0.15); color: #f97316; }
    
    .action-btn {
      padding: 8px 14px; border-radius: 8px; font-size: 12px;
      font-weight: 500; text-decoration: none; cursor: pointer; border: none;
      transition: opacity 0.2s;
    }
    .action-btn:hover { opacity: 0.8; }
    .action-btn.ig { background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045); color: #fff; }
    .action-btn.li { background: #0a66c2; color: #fff; }
    .action-btn.primary { background: #e63946; color: #fff; }
    .action-btn.secondary { background: rgba(255,255,255,0.1); color: #fff; }
    .action-btn.green { background: #10b981; color: #fff; }
    
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .modal-overlay.active { display: flex; }
    .modal {
      background: #1a1a2e;
      border-radius: 16px;
      width: 100%;
      max-width: 700px;
      max-height: 85vh;
      overflow-y: auto;
      border: 1px solid rgba(255,255,255,0.1);
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: #1a1a2e;
    }
    .modal-header h2 { font-size: 18px; font-weight: 600; }
    .modal-close {
      background: none; border: none; color: #888;
      font-size: 24px; cursor: pointer; line-height: 1;
    }
    .modal-body { padding: 20px; }
    .modal-section { margin-bottom: 20px; }
    .modal-section h3 { font-size: 13px; color: #888; margin-bottom: 8px; text-transform: uppercase; }
    .modal-section p { font-size: 14px; line-height: 1.6; }
    
    .form-row { margin-bottom: 12px; }
    .form-row label { display: block; font-size: 12px; color: #888; margin-bottom: 6px; }
    .form-row input, .form-row select, .form-row textarea {
      width: 100%; padding: 10px 14px;
      background: rgba(255,255,255,0.1);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 8px; color: #fff; font-size: 14px;
    }
    .form-row textarea { min-height: 80px; resize: vertical; }
    .form-inline { display: flex; gap: 12px; }
    .form-inline .form-row { flex: 1; }
    
    .empty { padding: 40px 20px; text-align: center; color: #666; font-size: 14px; }
    .loading { text-align: center; padding: 40px; color: #888; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .activity-item {
      padding: 12px 16px;
      border-left: 2px solid rgba(255,255,255,0.1);
      margin-left: 10px;
      position: relative;
    }
    .activity-item::before {
      content: '';
      width: 8px; height: 8px;
      background: #e63946;
      border-radius: 50%;
      position: absolute;
      left: -5px;
      top: 16px;
    }
    .activity-item.green::before { background: #10b981; }
    .activity-item.yellow::before { background: #f59e0b; }
    .activity-item.blue::before { background: #3b82f6; }
    .activity-item.purple::before { background: #8b5cf6; }
    .activity-text { font-size: 13px; }
    .activity-time { font-size: 11px; color: #666; margin-top: 4px; }
    
    .funnel-item {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .funnel-bar {
      flex: 1;
      height: 24px;
      background: rgba(255,255,255,0.05);
      border-radius: 4px;
      overflow: hidden;
    }
    .funnel-fill {
      height: 100%;
      background: linear-gradient(90deg, #e63946, #f97316);
      transition: width 0.5s ease;
    }
    .funnel-label { width: 140px; font-size: 13px; }
    .funnel-value { width: 80px; text-align: right; font-weight: 600; }
    .funnel-pct { width: 60px; text-align: right; color: #888; font-size: 12px; }
    
    .gap-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .gap-skill { width: 120px; font-size: 13px; font-weight: 500; }
    .gap-bars { flex: 1; display: flex; gap: 8px; }
    .gap-bar {
      height: 20px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      min-width: 30px;
    }
    .gap-bar.demand { background: rgba(239,68,68,0.3); color: #ef4444; }
    .gap-bar.supply { background: rgba(16,185,129,0.3); color: #10b981; }
    .gap-status { width: 80px; text-align: right; }
    
    .note-item {
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    .note-text { font-size: 13px; margin-bottom: 6px; }
    .note-time { font-size: 11px; color: #666; }
    
    .tag {
      display: inline-block;
      padding: 4px 10px;
      background: rgba(59,130,246,0.15);
      color: #3b82f6;
      border-radius: 20px;
      font-size: 11px;
      margin-right: 6px;
      margin-bottom: 6px;
    }
    .tag.vip { background: rgba(245,158,11,0.15); color: #f59e0b; }
    .tag.verified { background: rgba(16,185,129,0.15); color: #10b981; }
    
    .verification {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
    }
    .verification.phone { background: rgba(128,128,128,0.15); color: #888; }
    .verification.profile { background: rgba(59,130,246,0.15); color: #3b82f6; }
    .verification.work { background: rgba(139,92,246,0.15); color: #8b5cf6; }
    .verification.trusted { background: rgba(16,185,129,0.15); color: #10b981; }
    .verification.vip { background: rgba(245,158,11,0.15); color: #f59e0b; }
    
    .job-card {
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
      transition: background 0.2s;
    }
    .job-card:hover { background: rgba(255,255,255,0.03); }
    .job-card:last-child { border-bottom: none; }
    .job-title { font-weight: 600; font-size: 15px; margin-bottom: 6px; }
    .job-meta { font-size: 12px; color: #888; margin-bottom: 8px; }
    .job-text { font-size: 13px; color: #aaa; line-height: 1.5; margin-bottom: 10px; max-height: 60px; overflow: hidden; }
    .job-actions { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    
    /* Platform filter pills */
    .platform-filters {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 16px;
    }
    .platform-pill {
      padding: 8px 14px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      color: #888;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .platform-pill:hover {
      background: rgba(255,255,255,0.1);
      color: #fff;
    }
    .platform-pill.active {
      background: rgba(230,57,70,0.2);
      border-color: #e63946;
      color: #e63946;
    }
    .platform-pill .count {
      background: rgba(255,255,255,0.1);
      padding: 2px 6px;
      border-radius: 10px;
      font-size: 10px;
    }
    .platform-pill.active .count {
      background: rgba(230,57,70,0.3);
    }
    .platform-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 3px 8px;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .platform-badge.reddit { background: rgba(255,69,0,0.2); color: #ff4500; }
    .platform-badge.craigslist { background: rgba(88,0,255,0.2); color: #9d4edd; }
    .platform-badge.instagram { background: linear-gradient(135deg, rgba(131,58,180,0.2), rgba(253,29,29,0.2)); color: #e1306c; }
    .platform-badge.tiktok { background: rgba(0,0,0,0.3); color: #00f2ea; }
    .platform-badge.linkedin { background: rgba(10,102,194,0.2); color: #0a66c2; }
    .platform-badge.twitter { background: rgba(29,161,242,0.2); color: #1da1f2; }
    .platform-badge.threads { background: rgba(0,0,0,0.3); color: #fff; }
    .platform-badge.other { background: rgba(128,128,128,0.2); color: #888; }
  </style>
</head>
<body>
  <div class="login-screen" id="loginScreen">
    <form class="login-box" onsubmit="handleLogin(event)">
      <h1>TITLI</h1>
      <p>Command Center</p>
      <input type="password" id="password" placeholder="Enter password" required>
      <button type="submit">Enter</button>
    </form>
  </div>
  
  <div class="dashboard" id="dashboard">
    <header>
      <div><span class="logo">TITLI<span>Command Center</span></span></div>
      <div class="header-actions">
        <span class="last-updated" id="lastUpdated"></span>
        <button onclick="fetchAllData()">Refresh</button>
        <button class="logout" onclick="logout()">Logout</button>
      </div>
    </header>
    
    <div class="container">
      <div class="stats-grid">
        <div class="stat-card blue" onclick="switchTab('users')">
          <div class="stat-value" id="statUsers">0</div>
          <div class="stat-label">Total Users</div>
          <div class="stat-detail" id="statUsersDetail">-</div>
        </div>
        <div class="stat-card green" onclick="switchTab('connections')">
          <div class="stat-value" id="statConnections">0</div>
          <div class="stat-label">Connections</div>
          <div class="stat-detail">Successful matches</div>
        </div>
        <div class="stat-card purple" onclick="switchTab('requests')">
          <div class="stat-value" id="statRequests">0</div>
          <div class="stat-label">Total Requests</div>
          <div class="stat-detail" id="statRequestsDetail">-</div>
        </div>
        <div class="stat-card yellow" onclick="switchTab('unfilled')">
          <div class="stat-value" id="statUnfilled">0</div>
          <div class="stat-label">Need Matches</div>
          <div class="stat-detail">Recruitment opportunities</div>
        </div>
        <div class="stat-card orange" onclick="switchTab('external-jobs')">
          <div class="stat-value" id="statExternalJobs">0</div>
          <div class="stat-label">Scraped Jobs</div>
          <div class="stat-detail" id="statExternalJobsDetail">From n8n</div>
        </div>
        <div class="stat-card red" onclick="switchTab('activity')">
          <div class="stat-value" id="statActivity">0</div>
          <div class="stat-label">Actions Today</div>
          <div class="stat-detail">Taj activity</div>
        </div>
      </div>
      
      <div class="tabs">
        <button class="tab active" data-tab="overview">Overview</button>
        <button class="tab" data-tab="users">Users</button>
        <button class="tab" data-tab="requests">Requests</button>
        <button class="tab" data-tab="unfilled">Unfilled <span class="badge" id="unfilledBadge">0</span></button>
        <button class="tab" data-tab="connections">Connections</button>
        <button class="tab" data-tab="external-jobs">External Jobs <span class="badge" id="externalJobsBadge" style="background:#f97316;">0</span></button>
        <button class="tab" data-tab="skill-gaps">Skill Gaps</button>
        <button class="tab" data-tab="recruitment">Recruitment</button>
      </div>
      
      <div class="toolbar">
        <input type="text" class="search" placeholder="Search users, requests, skills..." oninput="handleSearch(this.value)">
        <select id="statusFilter" onchange="handleStatusFilter(this.value)" style="padding:8px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;">
          <option value="all">All Users</option>
          <option value="telegram">üì± On Telegram</option>
          <option value="complete">‚úì Complete+</option>
          <option value="verified">üíº Verified+</option>
          <option value="proven">‚≠ê Proven+</option>
          <option value="vip">üëë VIP Only</option>
        </select>
      </div>
      
      <!-- OVERVIEW TAB -->
      <div class="tab-content active" id="tab-overview">
        <div class="grid-3">
          <div class="card">
            <div class="card-header">Taj Activity (Last 24h)</div>
            <div id="recentActivity"><div class="loading">Loading...</div></div>
          </div>
          <div class="card highlight">
            <div class="card-header">Needs Your Attention <span class="count" id="attentionCount">0</span></div>
            <div id="needsAttention"><div class="loading">Loading...</div></div>
          </div>
          <div class="card">
            <div class="card-header">Conversion Funnel</div>
            <div id="quickFunnel"><div class="loading">Loading...</div></div>
          </div>
        </div>
        <div class="grid-2">
          <div class="card">
            <div class="card-header">Recent Users <span class="count" id="recentUsersCount">0</span></div>
            <div id="recentUsers"><div class="loading">Loading...</div></div>
          </div>
          <div class="card" style="border-color: rgba(249,115,22,0.3);">
            <div class="card-header" style="color:#f97316;">Latest Scraped Jobs <span class="count" id="recentJobsCount">0</span></div>
            <div id="recentJobs"><div class="loading">Loading...</div></div>
          </div>
        </div>
      </div>
      
      <!-- USERS TAB -->
      <div class="tab-content" id="tab-users">
        <div class="card"><div class="card-header" style="display:flex;justify-content:space-between;align-items:center;">
          <span>All Users <span class="count" id="userCount">0</span></span>
          <select id="userStatusFilter" onchange="handleUserStatusFilter(this.value)" style="padding:6px 10px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;">
            <option value="active">Active Users</option>
            <option value="all">All Users</option>
            <option value="blacklisted">Blacklisted Only</option>
          </select>
        </div><div id="allUsers"><div class="loading">Loading...</div></div></div>
      </div>
      
      <!-- REQUESTS TAB -->
      <div class="tab-content" id="tab-requests">
        <div class="card"><div class="card-header">All Requests <span class="count" id="requestCount">0</span></div><div id="allRequests"><div class="loading">Loading...</div></div></div>
      </div>
      
      <!-- UNFILLED TAB -->
      <div class="tab-content" id="tab-unfilled">
        <div class="card highlight"><div class="card-header">Recruitment Opportunities</div><div id="allUnfilled"><div class="loading">Loading...</div></div></div>
      </div>
      
      <!-- CONNECTIONS TAB -->
      <div class="tab-content" id="tab-connections">
        <div class="card success"><div class="card-header">Successful Connections <span class="count" id="connectionCount">0</span></div><div id="allConnections"><div class="loading">Loading...</div></div></div>
      </div>
      
      <!-- EXTERNAL JOBS TAB (NEW - from n8n) -->
      <div class="tab-content" id="tab-external-jobs">
        <!-- Platform Filter Pills -->
        <div class="platform-filters" id="platformFilters">
          <div class="platform-pill active" data-platform="all" onclick="filterByPlatform('all')">
            üåê All Platforms <span class="count" id="countAll">0</span>
          </div>
          <div class="platform-pill" data-platform="reddit" onclick="filterByPlatform('reddit')">
            üî¥ Reddit <span class="count" id="countReddit">0</span>
          </div>
          <div class="platform-pill" data-platform="craigslist" onclick="filterByPlatform('craigslist')">
            üìã Craigslist <span class="count" id="countCraigslist">0</span>
          </div>
          <div class="platform-pill" data-platform="instagram" onclick="filterByPlatform('instagram')">
            üì∏ Instagram <span class="count" id="countInstagram">0</span>
          </div>
          <div class="platform-pill" data-platform="tiktok" onclick="filterByPlatform('tiktok')">
            üéµ TikTok <span class="count" id="countTiktok">0</span>
          </div>
          <div class="platform-pill" data-platform="linkedin" onclick="filterByPlatform('linkedin')">
            üíº LinkedIn <span class="count" id="countLinkedin">0</span>
          </div>
          <div class="platform-pill" data-platform="twitter" onclick="filterByPlatform('twitter')">
            üê¶ X/Twitter <span class="count" id="countTwitter">0</span>
          </div>
          <div class="platform-pill" data-platform="threads" onclick="filterByPlatform('threads')">
            üßµ Threads <span class="count" id="countThreads">0</span>
          </div>
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;">
          <input type="text" id="jobSearch" class="search" placeholder="Search jobs by title, skills, subreddit..." oninput="filterJobs()" style="flex:1;min-width:200px;">
          <select id="jobPlatformFilter" onchange="filterByPlatformDropdown(this.value)" style="padding:8px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;">
            <option value="all">All Platforms</option>
            <option value="reddit">üî¥ Reddit</option>
            <option value="craigslist">üìã Craigslist</option>
            <option value="instagram">üì∏ Instagram</option>
            <option value="tiktok">üéµ TikTok</option>
            <option value="linkedin">üíº LinkedIn</option>
            <option value="twitter">üê¶ X/Twitter</option>
            <option value="threads">üßµ Threads</option>
          </select>
          <select id="jobStatusFilter" onchange="filterJobs()" style="padding:8px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;">
            <option value="all">All Jobs</option>
            <option value="new">New Only</option>
            <option value="reviewed">Reviewed</option>
            <option value="contacted">Contacted</option>
          </select>
          <select id="jobSortOrder" onchange="filterJobs()" style="padding:8px 12px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;">
            <option value="newest">Newest First</option>
            <option value="oldest">Oldest First</option>
            <option value="skills">Most Skills</option>
          </select>
        </div>
        <div class="card" style="border-color: rgba(249,115,22,0.3);">
          <div class="card-header" style="color:#f97316;">
            Scraped Jobs from n8n
            <span class="count" id="externalJobsCount">0 jobs</span>
          </div>
          <div id="allExternalJobs"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- JOB DETAIL MODAL -->
      <div class="modal-overlay" id="jobModal">
        <div class="modal" style="max-width:800px;">
          <div class="modal-header">
            <h2 id="modalJobTitle">Job Details</h2>
            <button class="modal-close" onclick="closeJobModal()">&times;</button>
          </div>
          <div class="modal-body" id="modalJobBody"></div>
        </div>
      </div>
      
      <!-- SKILL GAPS TAB -->
      <div class="tab-content" id="tab-skill-gaps">
        <div class="grid-2">
          <div class="card highlight"><div class="card-header">Skills Gap Analysis</div><div id="skillGapsAll"><div class="loading">Loading...</div></div></div>
          <div class="card"><div class="card-header">Available Skills</div><div id="availableSkills"><div class="loading">Loading...</div></div></div>
        </div>
        <div class="card" style="margin-top:20px;">
          <div class="card-header">ü§ñ AI Category Suggestions <span style="font-size:11px;color:#888;font-weight:normal;">Skills that need new categories</span></div>
          <div id="categorySuggestions"><div class="loading">Loading...</div></div>
        </div>
      </div>
      
      <!-- RECRUITMENT TAB -->
      <div class="tab-content" id="tab-recruitment">
        <div class="card">
          <div class="card-header">Recruitment Pipeline 
            <div style="display:flex;gap:8px;">
              <button class="action-btn secondary" onclick="getRecruitmentSuggestions()" style="padding:6px 12px;font-size:11px;">ü§ñ AI Suggestions</button>
              <button class="action-btn primary" onclick="showRecruitmentForm()" style="padding:6px 12px;font-size:11px;">+ Add Target</button>
            </div>
          </div>
          <div id="recruitmentSuggestions" style="display:none;padding:16px;background:rgba(139,92,246,0.1);border-bottom:1px solid rgba(139,92,246,0.3);"></div>
          <div id="recruitmentForm" style="display:none;padding:20px;border-bottom:1px solid rgba(255,255,255,0.1);">
            <div class="form-inline">
              <div class="form-row"><label>Name</label><input type="text" id="recruitName" placeholder="Person's name"></div>
              <div class="form-row"><label>Platform</label><select id="recruitPlatform"><option value="instagram">Instagram</option><option value="linkedin">LinkedIn</option><option value="twitter">Twitter/X</option><option value="other">Other</option></select></div>
            </div>
            <div class="form-row"><label>Profile URL</label><input type="text" id="recruitUrl" placeholder="https://instagram.com/..."></div>
            <div class="form-inline">
              <div class="form-row"><label>Skills (comma separated)</label><input type="text" id="recruitSkills" placeholder="Photography, Videography"></div>
              <div class="form-row"><label>Location</label><input type="text" id="recruitLocation" placeholder="Austin, TX"></div>
            </div>
            <div class="form-row"><label>Notes</label><input type="text" id="recruitNotes" placeholder="Optional notes"></div>
            <button class="action-btn primary" onclick="saveRecruitmentTarget()" style="width:100%;margin-top:8px;">Save Target</button>
          </div>
          <div id="allRecruitment"><div class="loading">Loading...</div></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- USER DETAIL MODAL -->
  <div class="modal-overlay" id="userModal">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalUserName">User Details</h2>
        <button class="modal-close" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modalUserBody"></div>
    </div>
  </div>

  <script>
    const API = "https://titly-backend-production.up.railway.app/api";
    const PASSWORD = "titli2024";
    
    let users = [], requests = [], unfilled = [], matches = [], connections = [], activity = [], categorySuggestions = [];
    let recruitmentTargets = [], externalJobs = [];
    let funnel = {}, skillGaps = {}, growth = {};
    let searchTerm = "";
    let statusFilter = 'all';
    let userStatusFilter = 'active';
    let platformFilter = 'all';
    
    const platformIcons = {
      reddit: 'üî¥',
      craigslist: 'üìã',
      instagram: 'üì∏',
      tiktok: 'üéµ',
      linkedin: 'üíº',
      twitter: 'üê¶',
      threads: 'üßµ',
      other: 'üåê'
    };
    
    if (localStorage.getItem("titli_admin") === "true") { 
      showDashboard(); 
      fetchAllData(); 
      setInterval(fetchAllData, 30000);
      const hash = window.location.hash.replace('#', '');
      if (hash) switchTab(hash);
    }
    
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById(`tab-${tab.dataset.tab}`).classList.add('active');
        window.location.hash = tab.dataset.tab;
      });
    });
    
    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      const tabEl = document.querySelector(`[data-tab="${tabId}"]`);
      if (tabEl) {
        tabEl.classList.add('active');
        document.getElementById(`tab-${tabId}`).classList.add('active');
        window.location.hash = tabId;
      }
    }
    
    function handleLogin(e) {
      e.preventDefault();
      if (document.getElementById("password").value === PASSWORD) {
        localStorage.setItem("titli_admin", "true");
        showDashboard(); fetchAllData(); setInterval(fetchAllData, 30000);
        const hash = window.location.hash.replace('#', '');
        if (hash) switchTab(hash);
      } else { alert("Wrong password"); }
    }
    
    function logout() { localStorage.removeItem("titli_admin"); location.reload(); }
    function showDashboard() { document.getElementById("loginScreen").style.display = "none"; document.getElementById("dashboard").classList.add("active"); }
    
    async function fetchAllData() {
      try {
        const [u, r, uf, m, c, a, rt, ej, f, sg, g, cs] = await Promise.all([
          fetch(`${API}/admin/users`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/requests`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/unfilled-requests`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/matches`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/connections`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/activity?limit=100`).then(res => res.json()).catch(() => []),
          fetch(`${API}/admin/recruitment/targets`).then(res => res.json()).catch(() => []),
          fetch(`https://titly-backend-production.up.railway.app/admin/external-jobs`).then(res => res.json()).catch(() => ({jobs: []})),
          fetch(`${API}/admin/analytics/funnel`).then(res => res.json()).catch(() => ({})),
          fetch(`${API}/admin/analytics/skill-gaps`).then(res => res.json()).catch(() => ({})),
          fetch(`${API}/admin/analytics/growth`).then(res => res.json()).catch(() => ({})),
          fetch(`${API}/admin/category-suggestions`).then(res => res.json()).catch(() => [])
        ]);
        users = u || []; requests = r || []; unfilled = uf || []; matches = m || []; connections = c || [];
        activity = a || []; recruitmentTargets = rt || []; externalJobs = ej?.jobs || []; categorySuggestions = cs || [];
        funnel = f || {}; skillGaps = sg || {}; growth = g || {};
        updateStats(); updatePlatformCounts(); render();
        document.getElementById("lastUpdated").textContent = `Updated: ${new Date().toLocaleTimeString()}`;
      } catch (e) { console.error("Fetch error:", e); }
    }
    
    function updateStats() {
      const telegramUsers = users.filter(u => u.telegram_connected).length;
      const todayActivity = activity.filter(a => new Date(a.timestamp).toDateString() === new Date().toDateString()).length;
      const newJobs = externalJobs.filter(j => j.status === 'new').length;
      
      document.getElementById("statUsers").textContent = users.length;
      document.getElementById("statUsersDetail").textContent = `${telegramUsers} on Telegram`;
      document.getElementById("statConnections").textContent = connections.length;
      document.getElementById("statRequests").textContent = requests.length;
      document.getElementById("statRequestsDetail").textContent = `${requests.filter(r => r.status === 'completed').length} completed`;
      document.getElementById("statUnfilled").textContent = unfilled.length;
      document.getElementById("statExternalJobs").textContent = externalJobs.length;
      document.getElementById("statExternalJobsDetail").textContent = `${newJobs} new`;
      document.getElementById("statActivity").textContent = todayActivity;
      document.getElementById("unfilledBadge").textContent = unfilled.length;
      document.getElementById("externalJobsBadge").textContent = newJobs;
      document.getElementById("attentionCount").textContent = unfilled.length + " items";
    }
    
    function updatePlatformCounts() {
      const counts = { all: externalJobs.length, reddit: 0, craigslist: 0, instagram: 0, tiktok: 0, linkedin: 0, twitter: 0, threads: 0 };
      externalJobs.forEach(job => {
        const platform = (job.platform || job.source || 'other').toLowerCase();
        if (counts.hasOwnProperty(platform)) counts[platform]++;
      });
      document.getElementById("countAll").textContent = counts.all;
      document.getElementById("countReddit").textContent = counts.reddit;
      document.getElementById("countCraigslist").textContent = counts.craigslist;
      document.getElementById("countInstagram").textContent = counts.instagram;
      document.getElementById("countTiktok").textContent = counts.tiktok;
      document.getElementById("countLinkedin").textContent = counts.linkedin;
      document.getElementById("countTwitter").textContent = counts.twitter;
      document.getElementById("countThreads").textContent = counts.threads;
      document.querySelectorAll('.platform-pill').forEach(pill => {
        const platform = pill.dataset.platform;
        if (platform !== 'all' && counts[platform] === 0) {
          pill.style.display = 'none';
        } else {
          pill.style.display = 'flex';
        }
      });
    }
    
    function filterByPlatform(platform) {
      platformFilter = platform;
      document.querySelectorAll('.platform-pill').forEach(pill => {
        pill.classList.remove('active');
        if (pill.dataset.platform === platform) pill.classList.add('active');
      });
      // Sync dropdown
      const dropdown = document.getElementById('jobPlatformFilter');
      if (dropdown) dropdown.value = platform;
      filterJobs();
    }
    
    function filterByPlatformDropdown(platform) {
      platformFilter = platform;
      // Sync pills
      document.querySelectorAll('.platform-pill').forEach(pill => {
        pill.classList.remove('active');
        if (pill.dataset.platform === platform) pill.classList.add('active');
      });
      filterJobs();
    }
    
    function handleSearch(term) { searchTerm = term.toLowerCase(); render(); }
    function handleStatusFilter(value) { statusFilter = value; render(); }
    
    const verificationOrder = ['unverified', 'phone', 'profile', 'work', 'trusted', 'vip'];
    function getVerificationLevel(level) { return verificationOrder.indexOf(level || 'phone'); }
    
    function getFilteredUsers() {
      return users.filter(u => {
        const matchesSearch = !searchTerm || u.name?.toLowerCase().includes(searchTerm) || u.phone?.includes(searchTerm) || u.skills?.some(s => s.toLowerCase().includes(searchTerm));
        let matchesStatusFilter = true;
        const level = getVerificationLevel(u.verification_level);
        if (statusFilter === 'telegram') matchesStatusFilter = u.telegram_connected;
        else if (statusFilter === 'complete') matchesStatusFilter = level >= 2;
        else if (statusFilter === 'verified') matchesStatusFilter = level >= 3;
        else if (statusFilter === 'proven') matchesStatusFilter = level >= 4;
        else if (statusFilter === 'vip') matchesStatusFilter = level >= 5;
        let matchesBlacklist = true;
        if (userStatusFilter === 'active') matchesBlacklist = u.blacklisted !== true;
        else if (userStatusFilter === 'blacklisted') matchesBlacklist = u.blacklisted === true;
        return matchesSearch && matchesStatusFilter && matchesBlacklist;
      });
    }
    
    function handleUserStatusFilter(value) { userStatusFilter = value; render(); }
    
    function render() {
      const filteredUsers = getFilteredUsers();
      
      // Overview tab
      document.getElementById("recentActivity").innerHTML = activity.length === 0 ? '<div class="empty">No activity yet</div>' : activity.slice(0, 10).map(a => activityItem(a)).join("");
      document.getElementById("needsAttention").innerHTML = unfilled.length === 0 ? '<div class="empty">All requests have matches!</div>' : unfilled.slice(0, 5).map(r => unfilledCard(r, true)).join("");
      
      if (funnel.funnel) {
        document.getElementById("quickFunnel").innerHTML = funnel.funnel.slice(0, 5).map(f => `<div class="funnel-item"><div class="funnel-label">${f.stage}</div><div class="funnel-bar"><div class="funnel-fill" style="width:${f.percentage}%"></div></div><div class="funnel-value">${f.count}</div><div class="funnel-pct">${f.percentage}%</div></div>`).join("");
      }
      
      document.getElementById("recentUsersCount").textContent = users.length;
      document.getElementById("recentUsers").innerHTML = users.length === 0 ? '<div class="empty">No users yet</div>' : users.slice(0, 5).map(u => userCard(u)).join("");
      
      // Recent jobs on overview
      document.getElementById("recentJobsCount").textContent = externalJobs.length;
      document.getElementById("recentJobs").innerHTML = externalJobs.length === 0 ? '<div class="empty">No scraped jobs yet. Run n8n workflow!</div>' : externalJobs.slice(0, 5).map(j => jobCard(j)).join("");
      
      // Activity tab
      document.getElementById("activityCount").textContent = activity.length;
      document.getElementById("allActivity").innerHTML = activity.length === 0 ? '<div class="empty">No activity yet</div>' : activity.map(a => activityItem(a)).join("");
      
      // Users tab
      document.getElementById("userCount").textContent = filteredUsers.length;
      document.getElementById("allUsers").innerHTML = filteredUsers.length === 0 ? '<div class="empty">No users found</div>' : filteredUsers.map(u => userCard(u, true)).join("");
      
      // Requests tab
      document.getElementById("requestCount").textContent = requests.length;
      document.getElementById("allRequests").innerHTML = requests.length === 0 ? '<div class="empty">No requests yet</div>' : requests.map(r => requestCard(r)).join("");
      
      // Unfilled tab
      document.getElementById("allUnfilled").innerHTML = unfilled.length === 0 ? '<div class="empty">All requests have matches!</div>' : unfilled.map(r => unfilledCard(r)).join("");
      
      // Connections tab
      document.getElementById("connectionCount").textContent = connections.length;
      document.getElementById("allConnections").innerHTML = connections.length === 0 ? '<div class="empty">No connections yet</div>' : connections.map(c => connectionCard(c)).join("");
      
      // External Jobs tab (NEW)
      document.getElementById("externalJobsCount").textContent = `${externalJobs.length} jobs`;
      document.getElementById("allExternalJobs").innerHTML = externalJobs.length === 0 ? '<div class="empty">No scraped jobs yet.<br><br>Your n8n workflow will automatically scrape Reddit every 6 hours.<br>Or run it manually from n8n to test.</div>' : externalJobs.map(j => jobCard(j, true)).join("");
      
      // Analytics tab
      if (funnel.funnel) { document.getElementById("funnelChart").innerHTML = funnel.funnel.map(f => `<div class="funnel-item"><div class="funnel-label">${f.stage}</div><div class="funnel-bar"><div class="funnel-fill" style="width:${f.percentage}%"></div></div><div class="funnel-value">${f.count}</div><div class="funnel-pct">${f.percentage}%</div></div>`).join(""); }
      if (growth.totals) {
        document.getElementById("growthChart").innerHTML = `<div style="padding:20px"><div style="display:flex;justify-content:space-around;text-align:center"><div><div style="font-size:32px;font-weight:700;color:#3b82f6">${growth.totals.users}</div><div style="font-size:12px;color:#888">Total Users</div></div><div><div style="font-size:32px;font-weight:700;color:#8b5cf6">${growth.totals.requests}</div><div style="font-size:12px;color:#888">Total Requests</div></div><div><div style="font-size:32px;font-weight:700;color:#10b981">${growth.totals.connections}</div><div style="font-size:12px;color:#888">Connections</div></div></div></div>`;
      }
      
      // Skill gaps tab
      if (skillGaps.skill_gaps) { document.getElementById("skillGapsAll").innerHTML = skillGaps.skill_gaps.map(g => `<div class="gap-item"><div class="gap-skill">${g.skill}</div><div class="gap-bars"><div class="gap-bar demand" style="width:${Math.min(g.demand * 30, 100)}px">${g.demand} need</div><div class="gap-bar supply" style="width:${Math.min(g.supply * 30, 100)}px">${g.supply} have</div></div><div class="gap-status">${g.gap > 0 ? `<span class="badge red">-${g.gap}</span>` : `<span class="badge green">+${Math.abs(g.gap)}</span>`}</div></div>`).join(""); }
      if (skillGaps.available_skills) { document.getElementById("availableSkills").innerHTML = `<div style="padding:16px">${Object.entries(skillGaps.available_skills).map(([skill, count]) => `<div style="display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05)"><span>${skill}</span><span class="badge purple">${count} users</span></div>`).join("")}</div>`; }
      
      // Category suggestions
      document.getElementById("categorySuggestions").innerHTML = categorySuggestions.length === 0 
        ? '<div class="empty">No new category suggestions yet.</div>'
        : `<div style="padding:16px;">${categorySuggestions.map(s => `<div style="display:flex;justify-content:space-between;align-items:center;padding:12px;margin-bottom:8px;background:rgba(139,92,246,0.1);border-radius:8px;"><div><div style="font-weight:600;color:#a78bfa;">"${s.skill}"</div><div style="font-size:12px;color:#888;">Suggested: ${s.suggested_category}</div></div><span class="badge purple">${s.count}x</span></div>`).join("")}</div>`;
      
      // Recruitment tab
      document.getElementById("allRecruitment").innerHTML = recruitmentTargets.length === 0 ? '<div class="empty">No recruitment targets yet</div>' : recruitmentTargets.map(t => recruitmentCard(t)).join("");
    }
    
    function activityItem(a) {
      const colors = { 'user_signup': 'blue', 'profile_completed': 'green', 'telegram_connected': 'cyan', 'request_created': 'purple', 'matches_found': 'yellow', 'outreach_sent': 'red', 'connection_made': 'green' };
      const icons = { 'user_signup': 'üë§', 'profile_completed': '‚úì', 'telegram_connected': 'üì±', 'request_created': 'üìã', 'matches_found': 'üîç', 'outreach_sent': 'üì§', 'connection_made': 'ü§ù', 'profile_enriched': '‚ú®' };
      let text = a.action.replace(/_/g, ' ');
      if (a.details) { if (a.details.name) text += `: ${a.details.name}`; if (a.details.title) text += `: ${a.details.title}`; }
      return `<div class="activity-item ${colors[a.action] || ''}"><div class="activity-text">${icons[a.action] || '‚Ä¢'} ${text}</div><div class="activity-time">${timeAgo(a.timestamp)}</div></div>`;
    }
    
    function userCard(u, detailed = false) {
      const verificationTiers = { unverified: { icon: '‚ö™', color: '#666' }, phone: { icon: 'üì±', color: '#3b82f6' }, profile: { icon: '‚úì', color: '#10b981' }, work: { icon: 'üíº', color: '#8b5cf6' }, trusted: { icon: '‚≠ê', color: '#f59e0b' }, vip: { icon: 'üëë', color: '#ec4899' } };
      const tier = verificationTiers[u.verification_level] || verificationTiers.phone;
      const blacklistBadge = u.blacklisted ? '<span class="badge" style="background:rgba(239,68,68,0.2);color:#ef4444;">‚õî</span>' : '';
      return `<div class="item-card" onclick="showUserDetail('${u.id}')" ${u.blacklisted ? 'style="opacity:0.6;"' : ''}><div class="item-header"><div class="avatar">${u.name?.charAt(0) || "?"}</div><div class="item-info"><div class="item-name">${u.name || "Unknown"} <span style="color:${tier.color};font-size:12px;">${tier.icon}</span></div><div class="item-sub">${u.phone || ""} ${u.location ? `‚Ä¢ ${u.location}` : ''}</div></div>${blacklistBadge}${u.telegram_connected && !u.blacklisted ? '<span class="badge green">Telegram</span>' : ''}</div><div class="item-meta">${(u.skills || []).slice(0, detailed ? 6 : 3).map(s => `<span class="skill-tag">${s}</span>`).join("")}</div></div>`;
    }
    
    function requestCard(r) {
      const colors = { 'in_progress': 'yellow', 'awaiting_approval': 'purple', 'matching': 'blue', 'completed': 'green', 'cancelled': 'gray' };
      const user = users.find(u => u.id === r.user_id);
      return `<div class="item-card"><div style="display:flex;justify-content:space-between;align-items:start"><div><div class="item-name">${r.title || "Untitled"}</div><div class="item-sub">By ${user?.name || 'Unknown'} ‚Ä¢ ${timeAgo(r.created_at)}</div></div><span class="badge ${colors[r.status] || 'gray'}">${r.status?.replace('_', ' ')}</span></div></div>`;
    }
    
    function unfilledCard(r, compact = false) {
      const searchTerm = encodeURIComponent(r.title || "");
      return `<div class="item-card" style="border-left:3px solid #f59e0b"><div class="item-name" style="color:#fbbf24">${r.title || "Untitled"}</div><div class="item-sub">By ${r.requester || 'Unknown'} ‚Ä¢ ${timeAgo(r.created_at)}</div>${!compact ? `<div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap"><a href="https://www.instagram.com/explore/search/keyword/?q=${searchTerm}" target="_blank" class="action-btn ig">Find on IG</a><a href="https://www.linkedin.com/search/results/people/?keywords=${searchTerm}" target="_blank" class="action-btn li">Find on LinkedIn</a></div>` : ''}</div>`;
    }
    
    function connectionCard(c) {
      return `<div class="item-card"><div style="display:flex;align-items:center;gap:12px"><div class="avatar" style="width:32px;height:32px;font-size:12px">${c.user_1?.name?.charAt(0) || "?"}</div><span style="color:#10b981">ü§ù</span><div class="avatar" style="width:32px;height:32px;font-size:12px">${c.user_2?.name?.charAt(0) || "?"}</div><div><div class="item-name">${c.user_1?.name || 'Unknown'} ‚Üî ${c.user_2?.name || 'Unknown'}</div><div class="item-sub">${c.request?.title || ''} ‚Ä¢ ${timeAgo(c.created_at)}</div></div></div></div>`;
    }
    
    function recruitmentCard(t) {
      const colors = { 'found': 'blue', 'contacted': 'yellow', 'responded': 'purple', 'joined': 'green', 'declined': 'red' };
      return `<div class="item-card"><div style="display:flex;justify-content:space-between;align-items:start"><div><div class="item-name">${t.name}</div><div class="item-sub">${t.platform} ‚Ä¢ <a href="${t.profile_url}" target="_blank" style="color:#3b82f6">View Profile</a></div></div><span class="badge ${colors[t.status]}">${t.status}</span></div></div>`;
    }
    
    // NEW: Job card for scraped jobs (Reddit, Craigslist, etc.)
    function jobCard(j, detailed = false) {
      const statusColors = { 'new': 'orange', 'reviewed': 'blue', 'contacted': 'yellow', 'converted': 'green', 'expired': 'gray' };
      const hasSkills = j.skills_needed && j.skills_needed.length > 0;
      const matchCount = j.matched_user_ids?.length || 0;
      
      // Platform detection
      const platform = (j.platform || j.source || 'reddit').toLowerCase();
      const platformIcon = platformIcons[platform] || 'üåê';
      
      // Check multiple possible URL field names
      const jobUrl = j.url || j.reddit_url || j.source_url || j.post_url || j.link || j.external_url;
      const authorName = j.author || j.reddit_author || 'unknown';
      const location = j.location || j.source_city || '';
      
      // Build source line based on platform
      let sourceLine = '';
      if (platform === 'reddit') {
        sourceLine = `r/${j.subreddit || 'unknown'} ‚Ä¢ <a href="https://reddit.com/u/${authorName}" target="_blank" style="color:#3b82f6;" onclick="event.stopPropagation();">u/${authorName}</a>`;
      } else if (platform === 'craigslist') {
        sourceLine = j.source_city || 'Craigslist';
      } else {
        sourceLine = authorName !== 'unknown' ? `@${authorName}` : platform;
      }
      
      return `<div class="job-card" onclick="showJobDetail('${j.id}')" style="cursor:pointer;">
        <div style="display:flex;justify-content:space-between;align-items:start;">
          <div style="flex:1;">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
              <span class="platform-badge ${platform}">${platformIcon} ${platform}</span>
              <div class="job-title" style="margin:0;">${j.title || 'Untitled'}</div>
            </div>
            <div class="job-meta">
              ${sourceLine} ‚Ä¢ ${timeAgo(j.created_at)}
              ${location ? `‚Ä¢ üìç ${location}` : ''}
              ${j.budget_range ? `‚Ä¢ üí∞ ${j.budget_range}` : ''}
            </div>
          </div>
          <span class="badge ${statusColors[j.status] || 'gray'}">${j.status || 'new'}</span>
        </div>
        ${detailed && (j.original_text || j.description) ? `<div class="job-text">${(j.original_text || j.description).substring(0, 200)}${(j.original_text || j.description).length > 200 ? '...' : ''}</div>` : ''}
        ${hasSkills ? `<div class="item-meta">${j.skills_needed.map(s => `<span class="skill-tag">${s}</span>`).join('')}</div>` : '<div style="font-size:11px;color:#666;margin-top:4px;">‚ö†Ô∏è No skills extracted yet</div>'}
        <div class="job-actions" onclick="event.stopPropagation();">
          ${jobUrl ? `<a href="${jobUrl}" target="_blank" class="action-btn secondary" style="padding:6px 10px;font-size:11px;">View Source ‚Üí</a>` : '<span style="font-size:11px;color:#666;">No link available</span>'}
          ${matchCount > 0 ? `<span class="badge green">${matchCount} matches</span>` : ''}
          ${j.status === 'new' ? `<button class="action-btn secondary" onclick="updateJobStatus('${j.id}', 'reviewed')" style="padding:6px 10px;font-size:11px;">Mark Reviewed</button>` : ''}
        </div>
      </div>`;
    }
    
    async function updateJobStatus(jobId, status) {
      try {
        await fetch(`https://titly-backend-production.up.railway.app/admin/external-jobs/${jobId}?status=${status}`, { method: 'PATCH' });
        fetchAllData();
      } catch (e) {
        console.error('Failed to update job status:', e);
      }
    }
    
    function showUserDetail(userId) {
      const user = users.find(u => u.id === userId);
      if (!user) return;
      document.getElementById("modalUserName").textContent = user.name || "User Details";
      const verificationTiers = { unverified: { icon: '‚ö™', name: 'New', color: '#666' }, phone: { icon: 'üì±', name: 'Signed Up', color: '#3b82f6' }, profile: { icon: '‚úì', name: 'Complete', color: '#10b981' }, work: { icon: 'üíº', name: 'Verified', color: '#8b5cf6' }, trusted: { icon: '‚≠ê', name: 'Proven', color: '#f59e0b' }, vip: { icon: 'üëë', name: 'VIP', color: '#ec4899' } };
      const currentTier = verificationTiers[user.verification_level || 'phone'] || verificationTiers.phone;
      const social = user.social_links || {};
      const ep = user.enriched_profile || {};
      const userRequests = requests.filter(r => r.user_id === user.id);
      const userActivity = activity.filter(a => a.details?.user_id === user.id || a.details?.name === user.name);
      
      // Profile header with image
      let html = `
      <div style="display:flex;gap:20px;align-items:flex-start;margin-bottom:20px;">
        <div class="avatar" style="width:80px;height:80px;font-size:32px;flex-shrink:0;${user.profile_image ? `background-image:url('${user.profile_image}');background-size:cover;background-position:center;` : ''}">${user.profile_image ? '' : (user.name?.charAt(0) || '?')}</div>
        <div style="flex:1;">
          <div style="font-size:20px;font-weight:700;margin-bottom:4px;">${user.name || 'Unknown'} <span style="color:${currentTier.color};font-size:14px;">${currentTier.icon} ${currentTier.name}</span></div>
          <div style="color:#888;font-size:13px;">${user.phone || ''} ${user.location ? `‚Ä¢ üìç ${user.location}` : ''}</div>
          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
            ${user.telegram_connected ? '<span class="badge green">üì± Telegram</span>' : '<span class="badge gray">No Telegram</span>'}
            ${social.instagram ? `<a href="${social.instagram.startsWith('http') ? social.instagram : 'https://instagram.com/' + social.instagram}" target="_blank" class="badge" style="background:linear-gradient(135deg,rgba(131,58,180,0.3),rgba(253,29,29,0.3));color:#ec4899;text-decoration:none;">üì∏ Instagram</a>` : ''}
            ${social.linkedin ? `<a href="${social.linkedin.startsWith('http') ? social.linkedin : 'https://linkedin.com/in/' + social.linkedin}" target="_blank" class="badge" style="background:rgba(10,102,194,0.3);color:#3b82f6;text-decoration:none;">üíº LinkedIn</a>` : ''}
          </div>
        </div>
      </div>`;
      
      // Taj's Notes (AI enriched profile)
      if (ep && Object.keys(ep).length > 0) {
        html += `
        <div class="modal-section" style="background:linear-gradient(135deg, rgba(139,92,246,0.15) 0%, rgba(236,72,153,0.1) 100%);padding:16px;border-radius:10px;border:1px solid rgba(139,92,246,0.3)">
          <h3 style="color:#a78bfa;margin-bottom:12px;">ü§ñ Taj's Notes</h3>
          ${ep.summary ? `<p style="margin-bottom:12px;font-style:italic;color:#e0e0e0;">"${ep.summary}"</p>` : ''}
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px;">
            ${ep.credibility_score ? `<div style="background:rgba(0,0,0,0.2);padding:8px;border-radius:6px;"><span style="font-size:11px;color:#888;">Credibility</span><br><strong style="font-size:18px;color:#10b981;">${ep.credibility_score}/100</strong></div>` : ''}
            ${ep.budget_range ? `<div style="background:rgba(0,0,0,0.2);padding:8px;border-radius:6px;"><span style="font-size:11px;color:#888;">Budget</span><br><strong style="color:#fff;">${ep.budget_range}</strong></div>` : ''}
          </div>
          ${ep.availability ? `<p style="margin-top:8px;"><span style="color:#888;">üìÖ Availability:</span> ${ep.availability}</p>` : ''}
          ${ep.industries?.length ? `<p><span style="color:#888;">üè¢ Industries:</span> ${ep.industries.join(', ')}</p>` : ''}
          ${ep.work_types?.length ? `<p><span style="color:#888;">üé¨ Work Types:</span> ${ep.work_types.join(', ')}</p>` : ''}
          ${ep.specialties?.length ? `<p><span style="color:#888;">‚≠ê Specialties:</span> ${ep.specialties.join(', ')}</p>` : ''}
          ${ep.extracted_skills?.length ? `<p><span style="color:#888;">üõ† Skills Found:</span> ${ep.extracted_skills.join(', ')}</p>` : ''}
          <p style="font-size:10px;color:#666;margin-top:8px;text-align:right;">Updated ${ep.enriched_at ? timeAgo(ep.enriched_at) : 'Unknown'}</p>
        </div>`;
      } else {
        html += `<div class="modal-section" style="background:rgba(255,255,255,0.03);padding:16px;border-radius:10px;border:1px dashed rgba(255,255,255,0.1);"><p style="color:#666;text-align:center;">ü§ñ Taj hasn't analyzed this profile yet.<br><span style="font-size:11px;">User needs to chat more with Taj to get AI insights.</span></p></div>`;
      }
      
      // Blacklist warning
      if (user.blacklisted) {
        html += `<div class="modal-section" style="background:rgba(239,68,68,0.2);padding:12px;border-radius:8px;border:1px solid rgba(239,68,68,0.5)"><span style="color:#ef4444;font-weight:600">‚õî BLACKLISTED</span>${user.blacklist_reason ? `<p style="color:#fca5a5;font-size:12px;margin-top:4px;">Reason: ${user.blacklist_reason}</p>` : ''}</div>`;
      }
      
      // Bio
      html += `<div class="modal-section"><h3>Bio</h3><p>${user.bio || '<span style="color:#666">No bio yet</span>'}</p></div>`;
      
      // Skills
      html += `<div class="modal-section"><h3>Skills</h3><div style="display:flex;gap:6px;flex-wrap:wrap">${(user.skills || []).map(s => `<span class="skill-tag">${s}</span>`).join('') || '<span style="color:#666">No skills added</span>'}</div></div>`;
      
      // Admin Notes
      html += `
      <div class="modal-section">
        <h3>Admin Notes</h3>
        <div id="userNotes">${(user.notes || []).map(n => `<div class="note-item"><div class="note-text">${n.note}</div><div class="note-time">${timeAgo(n.created_at)}</div></div>`).join('') || '<p style="color:#666">No notes yet</p>'}</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <input type="text" id="newNote" placeholder="Add a note about this user..." style="flex:1;padding:8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff">
          <button class="action-btn secondary" onclick="addNote('${user.id}')">Add</button>
        </div>
      </div>`;
      
      // Send Telegram Message
      html += `
      <div class="modal-section">
        <h3>Send Telegram Message</h3>
        ${user.telegram_connected ? `
          <div style="display:flex;gap:8px">
            <input type="text" id="telegramMsg" placeholder="Type message..." style="flex:1;padding:8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff">
            <button class="action-btn primary" onclick="sendTelegramMessage('${user.id}')">Send</button>
          </div>
        ` : '<p style="color:#666">User not connected to Telegram</p>'}
      </div>`;
      
      // User's Requests
      html += `
      <div class="modal-section">
        <h3>Requests (${userRequests.length})</h3>
        ${userRequests.length === 0 ? '<p style="color:#666">No requests yet</p>' : 
          userRequests.slice(0, 5).map(r => `
            <div style="padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05)">
              <div style="font-size:13px;font-weight:500;">${r.title || 'Untitled'}</div>
              <div style="font-size:11px;color:#666">${r.status?.replace('_', ' ')} ‚Ä¢ ${timeAgo(r.created_at)}</div>
            </div>
          `).join('')}
      </div>`;
      
      // Recent Activity
      html += `
      <div class="modal-section">
        <h3>Recent Activity (${userActivity.length})</h3>
        ${userActivity.length === 0 ? '<p style="color:#666">No activity recorded</p>' : 
          userActivity.slice(0, 5).map(a => `
            <div style="padding:6px 0;border-bottom:1px solid rgba(255,255,255,0.05);font-size:12px;">
              <span style="color:#888;">${a.action?.replace(/_/g, ' ')}</span>
              <span style="color:#666;float:right;">${timeAgo(a.timestamp)}</span>
            </div>
          `).join('')}
      </div>`;
      
      document.getElementById("modalUserBody").innerHTML = html;
      document.getElementById("userModal").classList.add("active");
    }
    
    async function addNote(userId) {
      const note = document.getElementById("newNote").value.trim();
      if (!note) return;
      try {
        await fetch(`${API}/admin/users/${userId}/notes?note=${encodeURIComponent(note)}`, { method: "POST" });
        document.getElementById("newNote").value = '';
        fetchAllData();
        setTimeout(() => showUserDetail(userId), 500);
      } catch (e) { alert("Failed to add note"); }
    }
    
    function closeModal() { document.getElementById("userModal").classList.remove("active"); }
    
    async function sendTelegramMessage(userId) { 
      const msg = document.getElementById("telegramMsg").value.trim(); 
      if (!msg) return; 
      try { 
        await fetch(`${API}/admin/users/${userId}/message?message=${encodeURIComponent(msg)}`, { method: "POST" }); 
        alert("Message sent!"); 
      } catch (e) { alert("Failed to send"); } 
    }
    
    function showRecruitmentForm() { const f = document.getElementById("recruitmentForm"); f.style.display = f.style.display === 'none' ? 'block' : 'none'; }
    
    async function saveRecruitmentTarget() {
      const name = document.getElementById("recruitName").value;
      const platform = document.getElementById("recruitPlatform").value;
      const url = document.getElementById("recruitUrl").value;
      const skills = document.getElementById("recruitSkills").value;
      const location = document.getElementById("recruitLocation").value;
      if (!name || !url) { alert("Name and URL required"); return; }
      const params = new URLSearchParams({ name, platform, profile_url: url });
      if (skills) params.append("skills", skills);
      if (location) params.append("location", location);
      await fetch(`${API}/admin/recruitment/targets?${params}`, { method: "POST" });
      document.getElementById("recruitmentForm").style.display = "none";
      fetchAllData();
    }
    
    async function getRecruitmentSuggestions() {
      const suggestEl = document.getElementById("recruitmentSuggestions");
      suggestEl.style.display = "block";
      suggestEl.innerHTML = "ü§ñ Analyzing talent gaps...";
      try {
        const res = await fetch(`${API}/admin/recruitment/suggestions`);
        const suggestions = await res.json();
        if (!suggestions || suggestions.length === 0) {
          suggestEl.innerHTML = `<div style="color:#a78bfa">No talent gaps detected!</div>`;
          return;
        }
        suggestEl.innerHTML = suggestions.map(s => `<div style="background:rgba(0,0,0,0.2);padding:12px;border-radius:8px;margin-bottom:8px;"><strong>${s.skill_needed}</strong> - Demand: ${s.demand}, Supply: ${s.supply}</div>`).join("");
      } catch (e) {
        suggestEl.innerHTML = "‚ùå Failed to get suggestions.";
      }
    }
    
    function timeAgo(dateString) {
      if (!dateString) return '';
      const seconds = Math.floor((new Date() - new Date(dateString)) / 1000);
      if (seconds < 60) return 'just now';
      if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
      if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
      if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
      return new Date(dateString).toLocaleDateString();
    }
    
    document.getElementById("userModal").addEventListener("click", function(e) { if (e.target === this) closeModal(); });
    document.getElementById("jobModal").addEventListener("click", function(e) { if (e.target === this) closeJobModal(); });
    
    // Job filtering
    function filterJobs() {
      const search = document.getElementById("jobSearch").value.toLowerCase();
      const status = document.getElementById("jobStatusFilter").value;
      const sort = document.getElementById("jobSortOrder").value;
      
      let filtered = externalJobs.filter(j => {
        // Platform filter
        const jobPlatform = (j.platform || j.source || 'reddit').toLowerCase();
        const matchesPlatform = platformFilter === 'all' || jobPlatform === platformFilter;
        
        const matchesSearch = !search || 
          (j.title || '').toLowerCase().includes(search) ||
          (j.subreddit || '').toLowerCase().includes(search) ||
          (j.source_city || '').toLowerCase().includes(search) ||
          (j.location || '').toLowerCase().includes(search) ||
          (j.original_text || '').toLowerCase().includes(search) ||
          (j.description || '').toLowerCase().includes(search) ||
          (j.skills_needed || []).some(s => s.toLowerCase().includes(search));
        const matchesStatus = status === 'all' || j.status === status;
        return matchesPlatform && matchesSearch && matchesStatus;
      });
      
      if (sort === 'newest') filtered.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      else if (sort === 'oldest') filtered.sort((a, b) => new Date(a.created_at) - new Date(b.created_at));
      else if (sort === 'skills') filtered.sort((a, b) => (b.skills_needed?.length || 0) - (a.skills_needed?.length || 0));
      
      document.getElementById("externalJobsCount").textContent = `${filtered.length} jobs`;
      document.getElementById("allExternalJobs").innerHTML = filtered.length === 0 
        ? '<div class="empty">No jobs match your filters</div>' 
        : filtered.map(j => jobCard(j, true)).join("");
    }
    
    // Find matching Titli users for a job
    function findMatchingUsers(skills) {
      if (!skills || !skills.length) return [];
      const normalizedSkills = skills.map(s => s.toLowerCase());
      return users.filter(u => {
        if (!u.skills || !u.skills.length) return false;
        const userSkills = u.skills.map(s => s.toLowerCase());
        const matched = normalizedSkills.filter(s => userSkills.some(us => us.includes(s) || s.includes(us)));
        if (matched.length > 0) {
          u._matchedSkills = matched;
          return true;
        }
        return false;
      }).slice(0, 5);
    }
    
    // Show job detail modal
    function showJobDetail(jobId) {
      const job = externalJobs.find(j => j.id === jobId);
      if (!job) return;
      
      document.getElementById("modalJobTitle").textContent = job.title || "Job Details";
      const matchingUsers = findMatchingUsers(job.skills_needed);
      
      // Platform detection
      const platform = (job.platform || job.source || 'reddit').toLowerCase();
      const platformIcon = platformIcons[platform] || 'üåê';
      
      // Check multiple possible URL field names
      const jobUrl = job.url || job.reddit_url || job.source_url || job.post_url || job.link || job.external_url;
      const authorName = job.author || job.reddit_author || 'unknown';
      const location = job.location || job.source_city || '';
      
      // Build source line based on platform
      let sourceHtml = '';
      if (platform === 'reddit') {
        sourceHtml = `<p>r/${job.subreddit || 'unknown'} ‚Ä¢ <a href="https://reddit.com/u/${authorName}" target="_blank" style="color:#3b82f6;">u/${authorName}</a> ‚Ä¢ ${timeAgo(job.created_at)}</p>`;
      } else if (platform === 'craigslist') {
        sourceHtml = `<p>${job.source_city || 'Unknown City'} ‚Ä¢ ${timeAgo(job.created_at)}</p>`;
      } else {
        sourceHtml = `<p>${authorName !== 'unknown' ? `@${authorName} ‚Ä¢ ` : ''}${timeAgo(job.created_at)}</p>`;
      }
      
      const outreachTemplate = platform === 'reddit' 
        ? `Hey! I saw your post on r/${job.subreddit || 'reddit'} about "${job.title || 'your project'}".

I run Titli - a network connecting filmmakers and creative professionals. We have talented ${(job.skills_needed || ['creatives']).slice(0, 3).join(', ')} who might be perfect for your project.

Would you like me to connect you with some matches? It's free!

Check us out: titli.app`
        : `Hi! I saw your post about "${job.title || 'your project'}".

I run Titli - a network connecting filmmakers and creative professionals. We have talented ${(job.skills_needed || ['creatives']).slice(0, 3).join(', ')} who might be perfect for your project.

Would you like me to connect you with some matches? It's free!

Check us out: titli.app`;
      
      let html = `
        <div class="modal-section">
          <h3>Source</h3>
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
            <span class="platform-badge ${platform}">${platformIcon} ${platform}</span>
          </div>
          ${sourceHtml}
          ${jobUrl ? `<p><a href="${jobUrl}" target="_blank" class="action-btn secondary" style="margin-top:8px;display:inline-block;">View on ${platform.charAt(0).toUpperCase() + platform.slice(1)} ‚Üí</a></p>` : '<p style="color:#666;font-size:12px;margin-top:8px;">No direct link available</p>'}
        </div>
        <div class="modal-section">
          <h3>Full Post</h3>
          <div style="background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;max-height:200px;overflow-y:auto;font-size:13px;line-height:1.6;">${job.original_text || job.description || 'No text available'}</div>
        </div>
        <div class="modal-section">
          <h3>Extracted Info</h3>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
            <div><strong style="color:#888;font-size:11px;">SKILLS</strong><div style="margin-top:4px;">${(job.skills_needed || []).map(s => `<span class="skill-tag">${s}</span>`).join('') || '<span style="color:#666">None extracted</span>'}</div></div>
            <div><strong style="color:#888;font-size:11px;">LOCATION</strong><div style="margin-top:4px;">${location || '<span style="color:#666">Not specified</span>'}</div></div>
            <div><strong style="color:#888;font-size:11px;">BUDGET</strong><div style="margin-top:4px;">${job.budget_range || '<span style="color:#666">Not specified</span>'}</div></div>
            <div><strong style="color:#888;font-size:11px;">URGENCY</strong><div style="margin-top:4px;">${job.urgency || '<span style="color:#666">Not specified</span>'}</div></div>
          </div>
        </div>
        <div class="modal-section">
          <h3>Matching Titli Users (${matchingUsers.length})</h3>
          ${matchingUsers.length === 0 
            ? '<p style="color:#666">No matching users found</p>' 
            : matchingUsers.map(u => `
              <div style="display:flex;align-items:center;gap:12px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.05);">
                <div class="avatar" style="width:32px;height:32px;font-size:12px;">${u.name?.charAt(0) || '?'}</div>
                <div style="flex:1;">
                  <div style="font-weight:600;">${u.name || 'Unknown'}</div>
                  <div style="font-size:11px;color:#888;">${u.location || 'No location'}</div>
                </div>
                <div>${(u._matchedSkills || []).map(s => `<span class="skill-tag" style="background:rgba(16,185,129,0.2);color:#10b981;">${s}</span>`).join('')}</div>
              </div>
            `).join('')}
        </div>
        <div class="modal-section">
          <h3>Outreach Template</h3>
          <textarea id="outreachText" style="width:100%;min-height:120px;padding:12px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;color:#fff;font-size:13px;resize:vertical;">${outreachTemplate}</textarea>
          <button class="action-btn primary" onclick="copyOutreach()" style="margin-top:8px;">üìã Copy to Clipboard</button>
        </div>
        <div class="modal-section" style="display:flex;gap:8px;">
          ${job.status === 'new' ? `<button class="action-btn secondary" onclick="updateJobStatus('${job.id}', 'reviewed'); closeJobModal();">Mark Reviewed</button>` : ''}
          ${job.status !== 'contacted' ? `<button class="action-btn green" onclick="updateJobStatus('${job.id}', 'contacted'); closeJobModal();">Mark Contacted</button>` : ''}
        </div>
      `;
      
      document.getElementById("modalJobBody").innerHTML = html;
      document.getElementById("jobModal").classList.add("active");
    }
    
    function closeJobModal() { document.getElementById("jobModal").classList.remove("active"); }
    
    function copyOutreach() {
      const text = document.getElementById("outreachText").value;
      navigator.clipboard.writeText(text).then(() => alert("Copied to clipboard!"));
    }
  </script>
</body>
</html>
